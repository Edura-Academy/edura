// Edura - Kurs Takip Sistemi Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

enum Role {
  admin
  mudur
  ogretmen
  sekreter
  ogrenci
  veli
}

enum SinifTipi {
  ORTAOKUL
  LISE
}

enum MessageStatus {
  OKUNMADI
  OKUNDU
}

enum NotificationType {
  BILDIRIM
  ONAY_TALEBI
  SISTEM
}

enum ExamType {
  DENEME
  SINAV
  QUIZ
}

enum OdevDurum {
  BEKLEMEDE
  TESLIM_EDILDI
  DEGERLENDIRILDI
}

enum YoklamaDurum {
  KATILDI
  KATILMADI
  GEC_KALDI
  IZINLI
}

// Kurslar/Şubeler
model Kurs {
  id          String   @id @default(uuid())
  ad          String   @unique // Edura Merkez, Edura Çankaya, etc.
  adres       String
  telefon     String
  aktif       Boolean  @default(true)
  
  siniflar    Sinif[]
  users       User[]
  duyurular   Duyuru[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Kullanıcılar tablosu - Tüm roller için merkezi tablo
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  ad                String
  soyad             String
  telefon           String?
  dogumTarihi       DateTime?
  role              Role
  aktif             Boolean  @default(true)
  olusturanId       String?  // Kim tarafından oluşturuldu
  olusturan         User?    @relation("UserOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  olusturulanlar    User[]   @relation("UserOlusturan")
  
  // Kurs ilişkisi
  kursId            String?
  kurs              Kurs?    @relation(fields: [kursId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Öğrenci özellikleri
  sinifId           String?
  sinif             Sinif?   @relation(fields: [sinifId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogrenciNo         String?  @unique
  
  // Veli bilgileri (öğrenci için - eski sistem, geriye uyumluluk)
  veliAd            String?
  veliSoyad         String?
  veliTelefon       String?
  veliEmail         String?
  
  // Veli-Öğrenci ilişkisi (yeni sistem)
  velisi            User?    @relation("VeliOgrenci", fields: [veliId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  veliId            String?
  cocuklari         User[]   @relation("VeliOgrenci")
  
  // Öğretmen özellikleri
  brans             String?
  
  // Push Notification
  fcmToken          String?   // Firebase Cloud Messaging token
  
  // İlişkiler
  gonderdigiMesajlar    Message[] @relation("GonderenMesajlar")
  aldigiMesajlar        Message[] @relation("AlanMesajlar")
  konusmaUyelikleri     ConversationMember[]
  bildirimleri          Notification[]
  sinavSonuclari        ExamResult[]
  dersKayitlari         CourseEnrollment[]
  ogretmenDersleri      Course[] @relation("OgretmenDersler")
  devamsizliklar        Devamsizlik[]
  yoklamalari           Yoklama[]
  ogretmenOdevleri      Odev[] @relation("OgretmenOdevler")
  odevTeslimleri        OdevTeslim[]
  duyurular             Duyuru[] @relation("DuyuruOlusturan")
  
  // Ödeme ilişkileri
  odemePlanlari         OdemePlani[] @relation("OgrenciOdemePlanlari")
  olusturduguOdemePlanlari OdemePlani[] @relation("OdemePlaniOlusturan")
  odemeler              Odeme[] @relation("OgrenciOdemeleri")
  onayladigiOdemeler    Odeme[] @relation("OdemeOnaylayan")
  
  // Online Sınav ilişkileri
  ogretmenOnlineSinavlar OnlineSinav[] @relation("OgretmenOnlineSinavlar")
  sinavOturumlari       SinavOturumu[] @relation("OgrenciSinavOturumlari")
  
  // Canlı Ders ilişkileri
  ogretmenCanliDersler  CanliDers[] @relation("OgretmenCanliDersler")
  canliDersKatilimlari  CanliDersKatilim[] @relation("OgrenciCanliDersKatilimlari")
  
  // Materyal ilişkileri
  yuklenanMateryaller   Materyal[] @relation("MateryalYukleyen")
  
  // Birebir Ders ilişkileri
  ogretmenBirebirDersler BirebirDers[] @relation("OgretmenBirebirDersler")
  ogrenciBirebirDersler  BirebirDers[] @relation("OgrenciBirebirDersler")
  birebirDersPaketleri   BirebirDersPaketi[] @relation("OgrenciBirebirPaketleri")
  
  // Gamification ilişkileri
  xpPuani               Int       @default(0)
  streak                Int       @default(0)
  sonAktiviteTarihi     DateTime?
  rozetler              Rozet[]
  gunlukGorevler        GunlukGorev[]
  gunSorusuCevaplari    GununSorusuCevap[]
  
  // Harici Deneme Sınavı ilişkileri
  olusturduguDenemeSinavlari DenemeSinavi[] @relation("DenemeSinavOlusturan")
  denemeSonuclari            DenemeSonucu[] @relation("OgrenciDenemeSonuclari")
  girdigiDenemeSonuclari     DenemeSonucu[] @relation("DenemeSonucuGiren")
  
  // Kurum İçi Deneme Sınavı ilişkileri
  kurumIciDenemeler          KurumIciDeneme[] @relation("KurumIciDenemeOlusturan")
  soruPaketleri              DenemeSoruPaketi[] @relation("OgretmenSoruPaketleri")
  denemeOturumlari           DenemeOturumu[] @relation("OgrenciDenemeOturumlari")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([email])
  @@index([role])
  @@index([sinifId])
  @@index([kursId])
  @@index([olusturanId])
  @@index([veliId])
}

// Sınıflar
model Sinif {
  id          String     @id @default(uuid())
  ad          String     // 8-A, 9-B, etc.
  seviye      Int        // 5, 6, 7, 8, 9, 10, 11, 12
  tip         SinifTipi  // ORTAOKUL, LISE
  kursId      String
  kurs        Kurs       @relation(fields: [kursId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  aktif       Boolean    @default(true)
  
  ogrenciler  User[]
  dersler     Course[]
  denemeSinavlari DenemeSinavi[] @relation("DenemeSinavSinif")
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@unique([ad, kursId]) // Aynı kursta aynı isimli sınıf olamaz
  @@index([kursId])
  @@index([seviye])
}

// Dersler (veritabanında "Ders" tablosu)
model Course {
  id              String   @id @default(uuid())
  ad              String
  aciklama        String?
  sinifId         String
  sinif           Sinif    @relation(fields: [sinifId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogretmenId      String
  ogretmen        User     @relation("OgretmenDersler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  gun             String   // Pazartesi, Salı, etc.
  baslangicSaati  String
  bitisSaati      String
  aktif           Boolean  @default(true)
  
  kayitlar        CourseEnrollment[]
  sinavlar        Exam[]
  devamsizliklar  Devamsizlik[]
  yoklamalar      Yoklama[]
  odevler         Odev[]
  onlineSinavlar  OnlineSinav[]
  canliDersler    CanliDers[]
  materyaller     Materyal[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([sinifId])
  @@index([ogretmenId])
  @@map("Ders")
}

// Ders kayıtları (veritabanında "DersKayit" tablosu)
model CourseEnrollment {
  id          String   @id @default(uuid())
  ogrenciId   String
  ogrenci     User     @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseId    String   @map("dersId")
  course      Course   @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kayitTarihi DateTime @default(now())
  aktif       Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([ogrenciId, courseId])
  @@index([ogrenciId])
  @@index([courseId])
  @@map("DersKayit")
}

// Sınavlar
model Exam {
  id          String     @id @default(uuid())
  ad          String
  tip         ExamType
  courseId    String
  course      Course     @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tarih       DateTime
  sure        Int?       // dakika
  toplamPuan  Int
  aciklama    String?
  
  sonuclar    ExamResult[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([courseId])
  @@index([tarih])
}

// Sınav sonuçları
model ExamResult {
  id          String   @id @default(uuid())
  examId      String
  exam        Exam     @relation(fields: [examId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogrenciId   String
  ogrenci     User     @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  puan        Float
  dogru       Int?
  yanlis      Int?
  bos         Int?
  yuzde       Float?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([examId, ogrenciId])
  @@index([ogrenciId])
  @@index([examId])
}

// Devamsızlık kayıtları
model Devamsizlik {
  id          String   @id @default(uuid())
  ogrenciId   String
  ogrenci     User     @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tarih       DateTime
  aciklama    String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([ogrenciId])
  @@index([courseId])
  @@index([tarih])
}

// Mesajlaşma sistemi - Konuşmalar (1-1 ve Grup)
enum ConversationType {
  OZEL       // 1-1 özel mesaj
  SINIF      // Sınıf grubu
  OGRETMEN   // Öğretmen grubu (aynı kursta)
  PERSONEL   // Personel grubu (müdür, sekreter, öğretmen)
  OZEL_GRUP  // Özel oluşturulan grup
}

model Conversation {
  id            String           @id @default(uuid())
  tip           ConversationType
  ad            String?          // Grup adı (1-1 için null)
  aciklama      String?
  resimUrl      String?
  olusturanId   String?
  
  // Sınıf grubu için
  sinifId       String?
  
  uyeler        ConversationMember[]
  mesajlar      Message[]
  
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  @@index([tip])
  @@index([sinifId])
  @@index([createdAt])
}

model ConversationMember {
  id              String       @id @default(uuid())
  conversationId  String
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  userId          String
  user            User         @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  rolAd           String?      // Grup içi rol: admin, uye
  seslesiz        Boolean      @default(false) // Bildirimleri kapat
  sabitle         Boolean      @default(false) // Konuşmayı sabitle
  sonGorulenMesajId String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
}

model Message {
  id              String        @id @default(uuid())
  conversationId  String
  conversation    Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  gonderenId      String
  gonderen        User          @relation("GonderenMesajlar", fields: [gonderenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Eski 1-1 mesaj sistemi için geriye uyumluluk
  alanId          String?
  alan            User?         @relation("AlanMesajlar", fields: [alanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  icerik          String        @db.Text
  baslik          String?
  durum           MessageStatus @default(OKUNMADI)
  
  // Ek özellikler
  dosyaUrl        String?
  dosyaTip        String?       // image, document, audio
  yanitladigiMesajId String?    // Yanıt verilen mesaj
  duzenlendi      Boolean       @default(false)
  silindi         Boolean       @default(false)
  
  okuyanlar       MessageRead[]
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([conversationId])
  @@index([gonderenId])
  @@index([alanId])
  @@index([durum])
  @@index([createdAt])
}

// Mesaj okunma durumu (grup mesajları için)
model MessageRead {
  id          String   @id @default(uuid())
  mesajId     String
  mesaj       Message  @relation(fields: [mesajId], references: [id], onDelete: Cascade)
  userId      String
  okunmaTarihi DateTime @default(now())
  
  @@unique([mesajId, userId])
  @@index([mesajId])
  @@index([userId])
}

// Bildirimler
model Notification {
  id          String           @id @default(uuid())
  userId      String
  user        User             @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tip         NotificationType
  baslik      String
  mesaj       String
  okundu      Boolean          @default(false)
  onayTalebi  Boolean          @default(false)
  onayDurumu  String?          // BEKLEMEDE, ONAYLANDI, REDDEDILDI
  ilgiliId    String?          // Onay için ilgili kayıt ID'si
  
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([userId])
  @@index([okundu])
  @@index([createdAt])
}

// Yoklama kayıtları - Öğretmen tarafından alınır
model Yoklama {
  id          String       @id @default(uuid())
  ogrenciId   String
  ogrenci     User         @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseId    String
  course      Course       @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tarih       DateTime     @default(now())
  durum       YoklamaDurum
  aciklama    String?
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@unique([ogrenciId, courseId, tarih])
  @@index([ogrenciId])
  @@index([courseId])
  @@index([tarih])
}

// Ödevler - Öğretmen tarafından verilir
model Odev {
  id              String    @id @default(uuid())
  baslik          String
  aciklama        String?
  courseId        String
  course          Course    @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogretmenId      String
  ogretmen        User      @relation("OgretmenOdevler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sonTeslimTarihi DateTime
  maxPuan         Int       @default(100)
  aktif           Boolean   @default(true)
  
  teslimler       OdevTeslim[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([courseId])
  @@index([ogretmenId])
  @@index([sonTeslimTarihi])
}

// Ödev teslimleri - Öğrenci tarafından teslim edilir, Öğretmen tarafından değerlendirilir
model OdevTeslim {
  id          String    @id @default(uuid())
  odevId      String
  odev        Odev      @relation(fields: [odevId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogrenciId   String
  ogrenci     User      @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teslimTarihi DateTime @default(now())
  dosyaUrl    String?
  aciklama    String?
  durum       OdevDurum @default(BEKLEMEDE)
  puan        Int?
  ogretmenYorumu String?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([odevId, ogrenciId])
  @@index([odevId])
  @@index([ogrenciId])
  @@index([durum])
}

// Duyuru hedef kitlesi
enum DuyuruHedef {
  HERKESE       // Tüm kullanıcılar
  SINIF         // Belirli sınıf(lar)
  OGRETMENLER   // Tüm öğretmenler
  OGRENCILER    // Tüm öğrenciler
  VELILER       // Tüm veliler
  PERSONEL      // Müdür, öğretmen, sekreter
}

enum DuyuruOncelik {
  NORMAL
  ONEMLI
  ACIL
}

// Duyurular
model Duyuru {
  id          String        @id @default(uuid())
  baslik      String
  icerik      String        @db.Text
  hedef       DuyuruHedef   @default(HERKESE)
  oncelik     DuyuruOncelik @default(NORMAL)
  
  // Hedef sınıflar (hedef SINIF ise)
  sinifIds    String?       // JSON array: ["sinif1-id", "sinif2-id"]
  
  // Dosya eki
  dosyaUrl    String?
  dosyaAd     String?
  
  // Oluşturan
  olusturanId String
  olusturan   User          @relation("DuyuruOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Kurs (opsiyonel - sadece o kursa özel)
  kursId      String?
  kurs        Kurs?         @relation(fields: [kursId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Yayın durumu
  aktif       Boolean       @default(true)
  yayinTarihi DateTime      @default(now())
  bitisTarihi DateTime?     // Opsiyonel: Duyurunun sona erme tarihi
  
  // Okunma takibi
  okuyanlar   DuyuruOkuma[]
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([olusturanId])
  @@index([kursId])
  @@index([hedef])
  @@index([aktif])
  @@index([yayinTarihi])
}

// Duyuru okunma takibi
model DuyuruOkuma {
  id          String   @id @default(uuid())
  duyuruId    String
  duyuru      Duyuru   @relation(fields: [duyuruId], references: [id], onDelete: Cascade)
  userId      String
  okunmaTarihi DateTime @default(now())
  
  @@unique([duyuruId, userId])
  @@index([duyuruId])
  @@index([userId])
}

// ================== ÖDEME SİSTEMİ ==================

enum OdemeDurum {
  BEKLEMEDE      // Ödeme bekleniyor
  ODENDI         // Ödeme yapıldı
  IPTAL          // İptal edildi
  IADE           // İade edildi
  GECIKTI        // Gecikmiş ödeme
}

enum OdemeTip {
  KAYIT          // Kayıt ücreti
  TAKSIT         // Aylık taksit
  EK_DERS        // Ek ders ücreti
  MATERYAL       // Materyal ücreti
  DIGER          // Diğer
}

enum OdemeYontemi {
  KREDI_KARTI    // Kredi kartı (iyzico)
  HAVALE         // Havale/EFT
  NAKIT          // Nakit
}

// Ödeme planları (öğrenci bazlı)
model OdemePlani {
  id              String   @id @default(uuid())
  ogrenciId       String
  ogrenci         User     @relation("OgrenciOdemePlanlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  donemAd         String   // "2024-2025 Güz Dönemi"
  toplamTutar     Float
  taksitSayisi    Int      @default(1)
  taksitTutari    Float
  
  // İndirim
  indirimOrani    Float?   @default(0)
  indirimTutari   Float?   @default(0)
  
  // Oluşturan
  olusturanId     String
  olusturan       User     @relation("OdemePlaniOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aciklama        String?
  aktif           Boolean  @default(true)
  
  odemeler        Odeme[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([ogrenciId])
  @@index([olusturanId])
  @@index([aktif])
}

// Tek tek ödemeler
model Odeme {
  id              String       @id @default(uuid())
  odemePlaniId    String?
  odemePlani      OdemePlani?  @relation(fields: [odemePlaniId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogrenciId       String
  ogrenci         User         @relation("OgrenciOdemeleri", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tip             OdemeTip
  tutar           Float
  durum           OdemeDurum   @default(BEKLEMEDE)
  
  // Taksit bilgisi
  taksitNo        Int?         // 1, 2, 3... (taksitli ödemelerde)
  vadeTarihi      DateTime
  
  // Ödeme bilgisi
  odemeYontemi    OdemeYontemi?
  odemeTarihi     DateTime?
  
  // iyzico bilgileri
  iyzicoPaymentId String?      // iyzico ödeme ID
  iyzicoConversationId String? // iyzico konuşma ID
  
  // Onaylayan
  onaylayanId     String?
  onaylayan       User?        @relation("OdemeOnaylayan", fields: [onaylayanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aciklama        String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([odemePlaniId])
  @@index([ogrenciId])
  @@index([durum])
  @@index([vadeTarihi])
}

// ================== CANLI DERS SİSTEMİ ==================

enum CanliDersDurum {
  PLANLANMIS     // Henüz başlamadı
  AKTIF          // Şu an devam ediyor
  SONA_ERDI      // Bitti
  IPTAL          // İptal edildi
}

// Canlı Dersler (Jitsi Meet entegrasyonu)
model CanliDers {
  id              String           @id @default(uuid())
  baslik          String
  aciklama        String?          @db.Text
  
  courseId        String
  course          Course           @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogretmenId      String
  ogretmen        User             @relation("OgretmenCanliDersler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Zamanlama
  baslangicTarihi DateTime
  bitisTarihi     DateTime
  
  // Jitsi bilgileri
  odaAdi          String           @unique  // Jitsi room name
  odaSifresi      String?                   // Opsiyonel şifre
  
  // Ayarlar
  kayitYapilsin   Boolean          @default(false)  // Dersi kaydet
  mikrofonAcik    Boolean          @default(false)  // Öğrenciler mikrofon açabilir
  kameraAcik      Boolean          @default(false)  // Öğrenciler kamera açabilir
  sohbetAcik      Boolean          @default(true)   // Sohbet aktif
  
  durum           CanliDersDurum   @default(PLANLANMIS)
  
  katilimlar      CanliDersKatilim[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([courseId])
  @@index([ogretmenId])
  @@index([durum])
  @@index([baslangicTarihi])
}

// Canlı Ders Katılım Takibi
model CanliDersKatilim {
  id              String      @id @default(uuid())
  canliDersId     String
  canliDers       CanliDers   @relation(fields: [canliDersId], references: [id], onDelete: Cascade)
  
  ogrenciId       String
  ogrenci         User        @relation("OgrenciCanliDersKatilimlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  girisZamani     DateTime    @default(now())
  cikisZamani     DateTime?
  
  // İstatistik
  toplamSure      Int?        // dakika cinsinden
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([canliDersId])
  @@index([ogrenciId])
  @@index([girisZamani])
}

// ================== ONLİNE SINAV SİSTEMİ ==================

enum SoruTipi {
  COKTAN_SECMELI   // A, B, C, D, E
  DOGRU_YANLIS     // Doğru / Yanlış
  ACIK_UCLU        // Yazılı cevap
  ESLESTIRME       // Eşleştirme
}

enum OnlineSinavDurum {
  TASLAK           // Henüz yayınlanmadı
  AKTIF            // Öğrenciler girebilir
  SONA_ERDI        // Süre doldu
  IPTAL            // İptal edildi
}

// Online Sınav
model OnlineSinav {
  id              String           @id @default(uuid())
  baslik          String
  aciklama        String?          @db.Text
  
  // Ders bağlantısı - opsiyonel (branş bazlı denemeler için courseId olmayabilir)
  courseId        String?
  course          Course?          @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Branş/Ders adı (deneme sınavları için)
  dersAdi         String?
  bransKodu       String?
  
  ogretmenId      String
  ogretmen        User             @relation("OgretmenOnlineSinavlar", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Sınav Ayarları
  sure            Int              // dakika cinsinden
  maksimumPuan    Float            @default(100)
  baslangicTarihi DateTime
  bitisTarihi     DateTime
  
  // Kurallar
  karistir        Boolean          @default(true)  // Soruları karıştır
  geriDonus       Boolean          @default(false) // Önceki soruya dönebilir mi
  sonucGoster     Boolean          @default(true)  // Bitince sonucu göster
  
  durum           OnlineSinavDurum @default(TASLAK)
  
  sorular         OnlineSoru[]
  oturumlar       SinavOturumu[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([courseId])
  @@index([ogretmenId])
  @@index([bransKodu])
  @@index([durum])
  @@index([baslangicTarihi])
}

// Sınav Soruları
model OnlineSoru {
  id              String       @id @default(uuid())
  sinavId         String
  sinav           OnlineSinav  @relation(fields: [sinavId], references: [id], onDelete: Cascade)
  
  soruMetni       String       @db.Text
  soruTipi        SoruTipi     @default(COKTAN_SECMELI)
  puan            Int          @default(10)
  siraNo          Int
  
  // Çoktan seçmeli için seçenekler (JSON array)
  secenekler      String?      @db.Text  // ["A şıkkı", "B şıkkı", "C şıkkı", "D şıkkı"]
  dogruCevap      String                 // "A" veya "DOGRU" veya açık uçlu için cevap
  
  // Görsel (opsiyonel)
  resimUrl        String?
  
  cevaplar        SinavCevap[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([sinavId])
  @@index([siraNo])
}

// Sınav Oturumu (öğrenci sınava girdiğinde)
model SinavOturumu {
  id              String       @id @default(uuid())
  sinavId         String
  sinav           OnlineSinav  @relation(fields: [sinavId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogrenciId       String
  ogrenci         User         @relation("OgrenciSinavOturumlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  baslangicZamani DateTime     @default(now())
  bitisZamani     DateTime?
  
  // Sonuç
  toplamPuan      Int?
  dogruSayisi     Int?
  yanlisSayisi    Int?
  bosSayisi       Int?
  yuzde           Float?
  
  // Soru sırası (karıştırıldıysa)
  soruSirasi      String?      @db.Text  // JSON array: ["soru-id-1", "soru-id-3", "soru-id-2"]
  
  tamamlandi      Boolean      @default(false)
  
  cevaplar        SinavCevap[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([sinavId, ogrenciId])
  @@index([sinavId])
  @@index([ogrenciId])
  @@index([tamamlandi])
}

// Öğrenci Cevapları
model SinavCevap {
  id              String        @id @default(uuid())
  oturumId        String
  oturum          SinavOturumu  @relation(fields: [oturumId], references: [id], onDelete: Cascade)
  
  soruId          String
  soru            OnlineSoru    @relation(fields: [soruId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  cevap           String?       // Öğrencinin verdiği cevap
  dogruMu         Boolean?      // Otomatik değerlendirme sonucu
  alinanPuan      Int?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@unique([oturumId, soruId])
  @@index([oturumId])
  @@index([soruId])
}

// ================== MATERYAL PAYLAŞIMI ==================

enum MateryalTipi {
  PDF
  VIDEO
  RESIM
  BELGE
  SUNUM
  DIGER
}

model Materyal {
  id              String        @id @default(uuid())
  baslik          String
  aciklama        String?       @db.Text
  
  courseId        String
  course          Course        @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  yukleyenId      String
  yukleyen        User          @relation("MateryalYukleyen", fields: [yukleyenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tip             MateryalTipi
  dosyaUrl        String
  dosyaAdi        String
  dosyaBoyutu     Int?          // byte cinsinden
  
  indirmeSayisi   Int           @default(0)
  aktif           Boolean       @default(true)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([courseId])
  @@index([yukleyenId])
  @@index([tip])
}

// ================== BİREBİR DERS SİSTEMİ ==================

enum BirebirDersDurum {
  PLANLANMIS
  TAMAMLANDI
  IPTAL
  GELMEDI
}

// Öğrenci saat paketi
model BirebirDersPaketi {
  id              String    @id @default(uuid())
  ogrenciId       String
  ogrenci         User      @relation("OgrenciBirebirPaketleri", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  toplamSaat      Int       // Satın alınan toplam saat
  kullanilanSaat  Int       @default(0)
  kalanSaat       Int       // Computed: toplamSaat - kullanilanSaat
  
  fiyat           Float?    // Paket fiyatı
  baslangicTarihi DateTime  @default(now())
  bitisTarihi     DateTime? // Paketin geçerlilik süresi
  
  aktif           Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([ogrenciId])
  @@index([aktif])
}

// Birebir ders randevuları
model BirebirDers {
  id              String           @id @default(uuid())
  
  ogretmenId      String
  ogretmen        User             @relation("OgretmenBirebirDersler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogrenciId       String
  ogrenci         User             @relation("OgrenciBirebirDersler", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  konu            String?          // Ders konusu
  aciklama        String?          @db.Text
  
  tarih           DateTime
  baslangicSaati  String           // "14:00"
  bitisSaati      String           // "15:00"
  sure            Int              @default(60) // dakika
  
  durum           BirebirDersDurum @default(PLANLANMIS)
  
  // Jitsi odası
  odaAdi          String?          @unique
  
  // Notlar
  ogretmenNotu    String?          @db.Text
  ogrenciNotu     String?          @db.Text
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([ogretmenId])
  @@index([ogrenciId])
  @@index([tarih])
  @@index([durum])
}

// ================== HARİCİ DENEME SINAVI SİSTEMİ ==================

enum DenemeTuru {
  TYT          // Temel Yeterlilik Testi (Lise)
  AYT          // Alan Yeterlilik Testi (Lise)
  LGS          // Liselere Geçiş Sınavı (Ortaokul)
  YDT          // Yabancı Dil Testi
  KURUM_ICI    // Kurum içi deneme
}

enum DenemeBrans {
  // TYT Branşları (120 soru)
  TYT_TURKCE        // 40 soru
  TYT_MATEMATIK     // 40 soru
  // Sosyal Bilimler (20 soru)
  TYT_TARIH         // 5 soru
  TYT_COGRAFYA      // 5 soru
  TYT_FELSEFE       // 5 soru
  TYT_DIN           // 5 soru
  // Fen Bilimleri (20 soru)
  TYT_FIZIK         // 7 soru
  TYT_KIMYA         // 7 soru
  TYT_BIYOLOJI      // 6 soru
  
  // AYT Branşları (160 soru)
  AYT_MATEMATIK     // 40 soru
  // Fen Bilimleri (40 soru)
  AYT_FIZIK         // 14 soru
  AYT_KIMYA         // 13 soru
  AYT_BIYOLOJI      // 13 soru
  // Edebiyat-Sosyal 1 (40 soru)
  AYT_EDEBIYAT      // 24 soru
  AYT_TARIH1        // 10 soru
  AYT_COGRAFYA1     // 6 soru
  // Sosyal Bilimler 2 (40 soru)
  AYT_TARIH2        // 11 soru
  AYT_COGRAFYA2     // 11 soru
  AYT_FELSEFE       // 12 soru
  AYT_DIN           // 6 soru
  
  // LGS Branşları (90 soru)
  LGS_TURKCE        // 20 soru
  LGS_MATEMATIK     // 20 soru
  LGS_FEN           // 20 soru
  LGS_INKILAP       // 10 soru (T.C. İnkılap Tarihi ve Atatürkçülük)
  LGS_DIN           // 10 soru
  LGS_INGILIZCE     // 10 soru
  
  // Yabancı Dil Testleri
  YDT_INGILIZCE
  YDT_ALMANCA
  YDT_FRANSIZCA
}

// Deneme Sınavı (Ana kayıt - harici kurumlardan gelen)
model DenemeSinavi {
  id              String       @id @default(uuid())
  ad              String       // "Kasım TYT Denemesi 1", "LGS Genel Deneme 3"
  tur             DenemeTuru   // TYT, AYT, LGS
  kurum           String?      // "Bilgi Sarmal", "Limit", "Kanguru", kurum içi için null
  
  tarih           DateTime
  
  // Hedef kitle
  sinifId         String?      // Belirli sınıf için (null = tüm sınıflar)
  sinif           Sinif?       @relation("DenemeSinavSinif", fields: [sinifId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kursId          String?      // Belirli kurs için (null = tüm kurslar)
  
  // Branş bazlı soru sayıları (JSON)
  // Örnek TYT: {"TYT_TURKCE": 40, "TYT_MATEMATIK": 40, "TYT_SOSYAL": 20, "TYT_FEN": 20}
  // Örnek LGS: {"LGS_TURKCE": 20, "LGS_MATEMATIK": 20, "LGS_FEN": 20, "LGS_SOSYAL": 10, "LGS_DIN": 10, "LGS_INGILIZCE": 10}
  branslarVeSoruSayilari String @db.Text
  
  aciklama        String?      @db.Text
  
  // Oluşturan
  olusturanId     String
  olusturan       User         @relation("DenemeSinavOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aktif           Boolean      @default(true)
  
  sonuclar        DenemeSonucu[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([tur])
  @@index([tarih])
  @@index([sinifId])
  @@index([kursId])
  @@index([olusturanId])
}

// Deneme Sonucu (Öğrenci bazlı, branş bazlı detaylar)
model DenemeSonucu {
  id              String        @id @default(uuid())
  sinavId         String
  sinav           DenemeSinavi  @relation(fields: [sinavId], references: [id], onDelete: Cascade)
  
  ogrenciId       String
  ogrenci         User          @relation("OgrenciDenemeSonuclari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Branş bazlı sonuçlar (JSON)
  // Her branş için: dogru, yanlis, bos, net, soruSayisi
  // Örnek: {"TYT_TURKCE": {"dogru": 30, "yanlis": 8, "bos": 2, "net": 28, "soruSayisi": 40}}
  branslarVeSonuclar String     @db.Text
  
  // Genel sonuçlar (hesaplanan)
  toplamDogru     Int
  toplamYanlis    Int
  toplamBos       Int
  toplamNet       Float        // Toplam net (tüm branşlar)
  genelPuan       Float?       // 500 puan hesaplaması (opsiyonel)
  
  // Sıralamalar (opsiyonel)
  sinifSirasi     Int?
  kursSirasi      Int?
  genelSiralama   Int?         // Tüm katılımcılar arasında
  
  // Sonuç giren
  girenId         String?
  giren           User?        @relation("DenemeSonucuGiren", fields: [girenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aciklama        String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([sinavId, ogrenciId])
  @@index([sinavId])
  @@index([ogrenciId])
  @@index([toplamNet])
  @@index([girenId])
}

// ================== GAMİFİCATİON SİSTEMİ ==================

enum RozetTipi {
  STREAK_7       // 7 gün streak
  STREAK_30      // 30 gün streak
  STREAK_100     // 100 gün streak
  ILK_ODEV       // İlk ödev teslimi
  ODEV_USTASI    // 50 ödev teslimi
  SINAV_SAMPIYONU // 10 sınavda %90+ 
  ERKEN_KUS      // Sabah 8'den önce görev
  GECE_KUSU      // Gece 22'den sonra görev
  SOSYAL_KELEBEK // 10 mesaj gönder
  CANLI_DERS_KATILIMCISI // 20 canlı derse katıl
  XP_1000        // 1000 XP topla
  XP_5000        // 5000 XP topla
  XP_10000       // 10000 XP topla
}

model Rozet {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tip             RozetTipi
  kazanilanTarih  DateTime  @default(now())
  
  createdAt       DateTime  @default(now())

  @@unique([userId, tip])
  @@index([userId])
}

enum GorevTipi {
  SORU_COZ       // X soru çöz
  KONU_BITIR     // X konu bitir
  ODEV_TESLIM    // Ödev teslim et
  CANLI_DERS     // Canlı derse katıl
  GUN_SORUSU     // Günün sorusunu çöz
  MATERYAL_INCELE // Materyal incele
}

model GunlukGorev {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tarih           DateTime  @db.Date
  tip             GorevTipi
  hedef           Int       // Hedef miktar (10 soru, 1 ödev vs)
  ilerleme        Int       @default(0) // Mevcut ilerleme
  tamamlandi      Boolean   @default(false)
  xpOdulu         Int       @default(10)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([userId, tarih, tip])
  @@index([userId])
  @@index([tarih])
}

// Günün sorusu (Lichess puzzle tarzı)
model GununSorusu {
  id              String    @id @default(uuid())
  tarih           DateTime  @unique @db.Date
  
  soruMetni       String    @db.Text
  secenekler      String    @db.Text  // JSON array
  dogruCevap      String
  aciklama        String?   @db.Text  // Çözüm açıklaması
  
  zorluk          Int       @default(1) // 1: Kolay, 2: Orta, 3: Zor
  xpOdulu         Int       @default(15)
  konu            String?   // Matematik, Fizik, vs.
  
  cevaplar        GununSorusuCevap[]
  
  createdAt       DateTime  @default(now())
}

model GununSorusuCevap {
  id              String       @id @default(uuid())
  gununSorusuId   String
  gununSorusu     GununSorusu  @relation(fields: [gununSorusuId], references: [id], onDelete: Cascade)
  
  userId          String
  user            User         @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  cevap           String
  dogruMu         Boolean
  ipucuKullanildi Boolean      @default(false)
  kazanilanXp     Int
  
  createdAt       DateTime     @default(now())

  @@unique([gununSorusuId, userId])
  @@index([gununSorusuId])
  @@index([userId])
}

// ================== ADMİN SİSTEM YÖNETİMİ ==================

enum AdminDuyuruOncelik {
  NORMAL
  ONEMLI
  ACIL
}

// Admin Sistem Duyuruları (Admin -> Müdürler)
model AdminDuyuru {
  id              String              @id @default(uuid())
  baslik          String
  icerik          String              @db.Text
  oncelik         AdminDuyuruOncelik  @default(NORMAL)
  
  // Dosya eki
  dosyaUrl        String?
  dosyaAd         String?
  
  aktif           Boolean             @default(true)
  yayinTarihi     DateTime            @default(now())
  bitisTarihi     DateTime?           // Duyurunun sona erme tarihi
  
  // Okunma takibi
  okuyanlar       AdminDuyuruOkuma[]
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([aktif])
  @@index([yayinTarihi])
  @@index([oncelik])
}

// Admin Duyuru Okunma Takibi
model AdminDuyuruOkuma {
  id              String       @id @default(uuid())
  adminDuyuruId   String
  adminDuyuru     AdminDuyuru  @relation(fields: [adminDuyuruId], references: [id], onDelete: Cascade)
  userId          String
  okunmaTarihi    DateTime     @default(now())
  
  @@unique([adminDuyuruId, userId])
  @@index([adminDuyuruId])
  @@index([userId])
}

// Sistem Güncellemeleri / Changelog
enum ChangelogTip {
  YENI_OZELLIK    // Yeni özellik eklendi
  IYILESTIRME     // Mevcut özellik iyileştirildi
  HATA_DUZELTME   // Bug fix
  GUVENLIK        // Güvenlik güncellemesi
  PERFORMANS      // Performans iyileştirmesi
}

model Changelog {
  id              String        @id @default(uuid())
  versiyon        String        // "1.2.0", "2.0.0"
  baslik          String
  aciklama        String        @db.Text
  tip             ChangelogTip  @default(YENI_OZELLIK)
  
  // Detaylı değişiklikler (JSON array)
  degisiklikler   String?       @db.Text  // ["Özellik 1 eklendi", "Bug düzeltildi"]
  
  yayinTarihi     DateTime      @default(now())
  aktif           Boolean       @default(true)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([yayinTarihi])
  @@index([aktif])
  @@index([tip])
}

// Destek Talebi / Ticket Sistemi
enum DestekTalebiDurum {
  ACIK            // Yeni açılan talep
  INCELENIYOR     // Admin inceleniyor
  CEVAPLANDI      // Admin cevapladı
  BEKLEMEDE       // Müdürden cevap bekleniyor
  COZULDU         // Çözüldü
  KAPATILDI       // Kapatıldı
}

enum DestekTalebiKategori {
  TEKNIK          // Teknik sorun
  OZELLIK_TALEBI  // Yeni özellik talebi
  FATURA          // Fatura/ödeme
  HESAP           // Hesap sorunları
  DIGER           // Diğer
}

enum DestekTalebiOncelik {
  DUSUK
  NORMAL
  YUKSEK
  ACIL
}

model DestekTalebi {
  id              String                  @id @default(uuid())
  baslik          String
  aciklama        String                  @db.Text
  
  kategori        DestekTalebiKategori    @default(TEKNIK)
  oncelik         DestekTalebiOncelik     @default(NORMAL)
  durum           DestekTalebiDurum       @default(ACIK)
  
  // Talep açan
  acanId          String
  kursId          String?                 // Hangi kurs adına (opsiyonel)
  
  // Dosya eki
  dosyaUrl        String?
  dosyaAd         String?
  
  // Çözüm notları
  cozumNotu       String?                 @db.Text
  kapatmaTarihi   DateTime?
  
  cevaplar        DestekTalebiCevap[]
  
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  @@index([acanId])
  @@index([kursId])
  @@index([durum])
  @@index([kategori])
  @@index([oncelik])
  @@index([createdAt])
}

// Destek Talebi Cevapları
model DestekTalebiCevap {
  id              String        @id @default(uuid())
  talepId         String
  talep           DestekTalebi  @relation(fields: [talepId], references: [id], onDelete: Cascade)
  
  cevaplayanId    String
  icerik          String        @db.Text
  
  // Dosya eki
  dosyaUrl        String?
  dosyaAd         String?
  
  // Admin mi, müdür mü yazdı
  adminYazdiMi    Boolean       @default(false)
  
  createdAt       DateTime      @default(now())

  @@index([talepId])
  @@index([cevaplayanId])
  @@index([createdAt])
}

// Yardım Merkezi / FAQ
enum FAQKategori {
  GENEL           // Genel sorular
  HESAP           // Hesap işlemleri
  OGRENCI         // Öğrenci yönetimi
  OGRETMEN        // Öğretmen yönetimi
  DERS            // Ders/sınıf yönetimi
  ODEME           // Ödeme işlemleri
  SINAV           // Sınav sistemi
  CANLI_DERS      // Canlı ders
  MESAJLASMA      // Mesajlaşma
  TEKNIK          // Teknik sorular
}

model FAQ {
  id              String       @id @default(uuid())
  soru            String
  cevap           String       @db.Text
  kategori        FAQKategori  @default(GENEL)
  siraNo          Int          @default(0)  // Görüntüleme sırası
  
  // SEO ve arama için
  anahtarKelimeler String?     // "öğrenci, ekleme, kayıt"
  
  // İstatistik
  goruntulemeSayisi Int        @default(0)
  faydaliSayisi     Int        @default(0)  // Faydalı buldum
  
  aktif           Boolean      @default(true)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([kategori])
  @@index([aktif])
  @@index([siraNo])
}

// ================== KURUM İÇİ DENEME SINAVI SİSTEMİ ==================

enum KurumIciDenemeDurum {
  HAZIRLANIYOR    // Öğretmenler soru hazırlıyor
  ONAY_BEKLIYOR   // Müdür onayı bekliyor
  AKTIF           // Yayında, öğrenciler çözebilir
  TAMAMLANDI      // Sınav süresi doldu
  IPTAL           // İptal edildi
}

// Kurum İçi Deneme Sınavı (Müdür tarafından başlatılır)
model KurumIciDeneme {
  id              String       @id @default(uuid())
  ad              String       // "2024 Ocak LGS Denemesi"
  tur             DenemeTuru   // TYT, AYT, LGS
  
  // Hedef sınıflar (JSON array)
  // Örnek: ["9-A", "9-B", "10-A"] veya ["8-A", "8-B"] LGS için
  hedefSiniflar   String       @db.Text
  
  // Sınav zamanlaması
  baslangicTarihi DateTime
  bitisTarihi     DateTime
  sure            Int          // dakika cinsinden toplam süre
  
  // Durum
  durum           KurumIciDenemeDurum @default(HAZIRLANIYOR)
  
  // Oluşturan (Müdür)
  olusturanId     String
  olusturan       User         @relation("KurumIciDenemeOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Branş soru paketleri
  soruPaketleri   DenemeSoruPaketi[]
  
  // Öğrenci oturumları
  oturumlar       DenemeOturumu[]
  
  aciklama        String?      @db.Text
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([tur])
  @@index([durum])
  @@index([baslangicTarihi])
  @@index([olusturanId])
}

// Branş bazlı soru paketi (Her öğretmen kendi branşı için hazırlar)
model DenemeSoruPaketi {
  id              String       @id @default(uuid())
  
  denemeId        String
  deneme          KurumIciDeneme @relation(fields: [denemeId], references: [id], onDelete: Cascade)
  
  // Branş bilgisi
  bransKodu       DenemeBrans  // TYT_TURKCE, LGS_MATEMATIK, vs.
  bransAdi        String       // "Türkçe", "Matematik", vs.
  soruSayisi      Int          // Bu branş için beklenen soru sayısı
  
  // Hazırlayan öğretmen
  ogretmenId      String
  ogretmen        User         @relation("OgretmenSoruPaketleri", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Sorular (JSON array)
  // Her soru: { 
  //   id: uuid,
  //   soruMetni: string, 
  //   resimUrl?: string (max 8MB, Firebase Storage),
  //   secenekA: string,
  //   secenekB: string,
  //   secenekC: string,
  //   secenekD: string,
  //   secenekE?: string (LGS için null),
  //   dogruCevap: 'A'|'B'|'C'|'D'|'E', 
  //   puan: number
  // }
  sorular         String?      @db.LongText
  
  // Onay durumu
  hazirMi         Boolean      @default(false)  // Öğretmen tamamladı mı
  onaylandiMi     Boolean      @default(false)  // Müdür onayladı mı
  onaylayanId     String?
  onayTarihi      DateTime?
  
  // Geri bildirim (müdürden öğretmene)
  geriBildirim    String?      @db.Text
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([denemeId, bransKodu])
  @@index([denemeId])
  @@index([ogretmenId])
  @@index([hazirMi])
  @@index([onaylandiMi])
}

// Öğrenci deneme oturumu
model DenemeOturumu {
  id              String       @id @default(uuid())
  
  denemeId        String
  deneme          KurumIciDeneme @relation(fields: [denemeId], references: [id], onDelete: Cascade)
  
  ogrenciId       String
  ogrenci         User         @relation("OgrenciDenemeOturumlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  baslangicZamani DateTime     @default(now())
  bitisZamani     DateTime?
  
  // Cevaplar (JSON)
  // { "TYT_TURKCE": ["A", "B", "C", ...], "TYT_MATEMATIK": [...] }
  cevaplar        String?      @db.LongText
  
  // Sonuçlar (hesaplanan)
  // { "TYT_TURKCE": { dogru: 30, yanlis: 8, bos: 2, net: 28 }, ... }
  sonuclar        String?      @db.LongText
  toplamNet       Float?
  
  tamamlandi      Boolean      @default(false)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([denemeId, ogrenciId])
  @@index([denemeId])
  @@index([ogrenciId])
  @@index([tamamlandi])
}