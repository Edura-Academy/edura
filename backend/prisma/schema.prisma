// Edura - Kurs Takip Sistemi Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

enum Role {
  admin
  kursSahibi  // Kurs sahibi (Patron) - Kurs hesabÄ±nÄ± yÃ¶neten kiÅŸi
  mudur
  ogretmen
  sekreter
  ogrenci
  veli
}

enum SinifTipi {
  ORTAOKUL
  LISE
}

enum MessageStatus {
  OKUNMADI
  OKUNDU
}

enum NotificationType {
  BILDIRIM
  ONAY_TALEBI
  SISTEM
}

enum ExamType {
  DENEME
  SINAV
  QUIZ
}

enum OdevDurum {
  BEKLEMEDE
  TESLIM_EDILDI
  DEGERLENDIRILDI
  GEC_TESLIM       // GeÃ§ teslim edildi
}

enum OdevTipi {
  TEST            // Ã‡oktan seÃ§meli test sorularÄ±
  SORU_CEVAP      // Klasik sorular (metin cevaplÄ±)
  DOSYA_YUKLE     // Sadece dosya yÃ¼kleme
  KARISIK         // Test ve klasik sorular bir arada
}

enum YoklamaDurum {
  KATILDI
  KATILMADI
  GEC_KALDI
  IZINLI
}

// Kurslar/Åubeler
model Kurs {
  id          String   @id @default(uuid())
  ad          String   @unique // Edura Merkez, Edura Ã‡ankaya, etc.
  adres       String
  telefon     String
  aktif       Boolean  @default(true)
  
  // Kurs Sahibi iliÅŸkisi
  sahipId     String?
  sahip       User?    @relation("KursSahibi", fields: [sahipId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  siniflar    Sinif[]
  users       User[]
  duyurular   Duyuru[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([sahipId])
}

// KullanÄ±cÄ±lar tablosu - TÃ¼m roller iÃ§in merkezi tablo
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  ad                String
  soyad             String
  telefon           String?
  dogumTarihi       DateTime?
  role              Role
  aktif             Boolean  @default(true)
  olusturanId       String?  // Kim tarafÄ±ndan oluÅŸturuldu
  olusturan         User?    @relation("UserOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  olusturulanlar    User[]   @relation("UserOlusturan")
  
  // Kurs iliÅŸkisi
  kursId            String?
  kurs              Kurs?    @relation(fields: [kursId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Ã–ÄŸrenci Ã¶zellikleri
  sinifId           String?
  sinif             Sinif?   @relation(fields: [sinifId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogrenciNo         String?  @unique
  
  // Veli bilgileri (Ã¶ÄŸrenci iÃ§in - eski sistem, geriye uyumluluk)
  veliAd            String?
  veliSoyad         String?
  veliTelefon       String?
  veliEmail         String?
  
  // Veli-Ã–ÄŸrenci iliÅŸkisi (yeni sistem)
  velisi            User?    @relation("VeliOgrenci", fields: [veliId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  veliId            String?
  cocuklari         User[]   @relation("VeliOgrenci")
  
  // Ã–ÄŸretmen Ã¶zellikleri
  brans             String?
  
  // Push Notification
  fcmToken          String?   // Firebase Cloud Messaging token
  
  // Profil FotoÄŸrafÄ±
  profilFoto        String?   // Firebase Storage URL
  
  // Ä°liÅŸkiler
  gonderdigiMesajlar    Message[] @relation("GonderenMesajlar")
  aldigiMesajlar        Message[] @relation("AlanMesajlar")
  konusmaUyelikleri     ConversationMember[]
  bildirimleri          Notification[]
  sinavSonuclari        ExamResult[]
  dersKayitlari         CourseEnrollment[]
  ogretmenDersleri      Course[] @relation("OgretmenDersler")
  devamsizliklar        Devamsizlik[]
  yoklamalari           Yoklama[]
  ogretmenOdevleri      Odev[] @relation("OgretmenOdevler")
  odevTeslimleri        OdevTeslim[]
  duyurular             Duyuru[] @relation("DuyuruOlusturan")
  
  // Ã–deme iliÅŸkileri
  odemePlanlari         OdemePlani[] @relation("OgrenciOdemePlanlari")
  olusturduguOdemePlanlari OdemePlani[] @relation("OdemePlaniOlusturan")
  odemeler              Odeme[] @relation("OgrenciOdemeleri")
  onayladigiOdemeler    Odeme[] @relation("OdemeOnaylayan")
  
  // Online SÄ±nav iliÅŸkileri
  ogretmenOnlineSinavlar OnlineSinav[] @relation("OgretmenOnlineSinavlar")
  sinavOturumlari       SinavOturumu[] @relation("OgrenciSinavOturumlari")
  
  // CanlÄ± Ders iliÅŸkileri
  ogretmenCanliDersler  CanliDers[] @relation("OgretmenCanliDersler")
  canliDersKatilimlari  CanliDersKatilim[] @relation("OgrenciCanliDersKatilimlari")
  
  // Materyal iliÅŸkileri
  yuklenanMateryaller   Materyal[] @relation("MateryalYukleyen")
  
  // Soru Havuzu iliÅŸkileri (Ã–ÄŸretmenler soru ekleyebilir)
  ekledigiSorular       SoruHavuzu[] @relation("OgretmenSorulari")
  
  // Birebir Ders iliÅŸkileri
  ogretmenBirebirDersler BirebirDers[] @relation("OgretmenBirebirDersler")
  ogrenciBirebirDersler  BirebirDers[] @relation("OgrenciBirebirDersler")
  birebirDersPaketleri   BirebirDersPaketi[] @relation("OgrenciBirebirPaketleri")
  
  // Gamification iliÅŸkileri
  xpPuani               Int       @default(0)
  xpSeviye              XPSeviye  @default(BASLANGIC) // BaÅŸlangÄ±Ã§, Ã‡Ä±rak, Usta, Uzman, Efsane
  streak                Int       @default(0)
  enYuksekStreak        Int       @default(0) // Rekor streak
  sonAktiviteTarihi     DateTime?
  
  // CS:GO tarzÄ± gÃ¶sterilecek rozet seÃ§imi
  seciliRozetId         String?   // Profilde gÃ¶sterilecek rozet
  
  // Ä°statistikler
  toplamCozulenSoru     Int       @default(0)
  toplamDogruCevap      Int       @default(0)
  toplamTeslimOdev      Int       @default(0)
  toplamKatilinanDers   Int       @default(0)
  
  rozetler              Rozet[]
  gunlukGorevler        GunlukGorev[]
  gunSorusuCevaplari    GununSorusuCevap[]
  
  // Harici Deneme SÄ±navÄ± iliÅŸkileri
  olusturduguDenemeSinavlari DenemeSinavi[] @relation("DenemeSinavOlusturan")
  denemeSonuclari            DenemeSonucu[] @relation("OgrenciDenemeSonuclari")
  girdigiDenemeSonuclari     DenemeSonucu[] @relation("DenemeSonucuGiren")
  denemeHedefleri            DenemeHedef[]
  
  // Kurum Ä°Ã§i Deneme SÄ±navÄ± iliÅŸkileri
  kurumIciDenemeler          KurumIciDeneme[] @relation("KurumIciDenemeOlusturan")
  soruPaketleri              DenemeSoruPaketi[] @relation("OgretmenSoruPaketleri")
  denemeOturumlari           DenemeOturumu[] @relation("OgrenciDenemeOturumlari")
  
  // Kurs SahipliÄŸi iliÅŸkisi
  sahipOlduguKurslar         Kurs[] @relation("KursSahibi")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([email])
  @@index([role])
  @@index([sinifId])
  @@index([kursId])
  @@index([olusturanId])
  @@index([veliId])
}

// SÄ±nÄ±flar
model Sinif {
  id          String     @id @default(uuid())
  ad          String     // 8-A, 9-B, etc.
  seviye      Int        // 5, 6, 7, 8, 9, 10, 11, 12
  tip         SinifTipi  // ORTAOKUL, LISE
  kursId      String
  kurs        Kurs       @relation(fields: [kursId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  aktif       Boolean    @default(true)
  
  ogrenciler  User[]
  dersler     Course[]
  denemeSinavlari DenemeSinavi[] @relation("DenemeSinavSinif")
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@unique([ad, kursId]) // AynÄ± kursta aynÄ± isimli sÄ±nÄ±f olamaz
  @@index([kursId])
  @@index([seviye])
}

// Dersler (veritabanÄ±nda "Ders" tablosu)
model Course {
  id              String   @id @default(uuid())
  ad              String
  aciklama        String?
  sinifId         String
  sinif           Sinif    @relation(fields: [sinifId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogretmenId      String
  ogretmen        User     @relation("OgretmenDersler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  gun             String   // Pazartesi, SalÄ±, etc.
  baslangicSaati  String
  bitisSaati      String
  aktif           Boolean  @default(true)
  
  kayitlar        CourseEnrollment[]
  sinavlar        Exam[]
  devamsizliklar  Devamsizlik[]
  yoklamalar      Yoklama[]
  odevler         Odev[]
  onlineSinavlar  OnlineSinav[]
  canliDersler    CanliDers[]
  materyaller     Materyal[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([sinifId])
  @@index([ogretmenId])
  @@map("Ders")
}

// Ders kayÄ±tlarÄ± (veritabanÄ±nda "DersKayit" tablosu)
model CourseEnrollment {
  id          String   @id @default(uuid())
  ogrenciId   String
  ogrenci     User     @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseId    String   @map("dersId")
  course      Course   @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kayitTarihi DateTime @default(now())
  aktif       Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([ogrenciId, courseId])
  @@index([ogrenciId])
  @@index([courseId])
  @@map("DersKayit")
}

// SÄ±navlar
model Exam {
  id          String     @id @default(uuid())
  ad          String
  tip         ExamType
  courseId    String
  course      Course     @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tarih       DateTime
  sure        Int?       // dakika
  toplamPuan  Int
  aciklama    String?
  
  sonuclar    ExamResult[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([courseId])
  @@index([tarih])
}

// SÄ±nav sonuÃ§larÄ±
model ExamResult {
  id          String   @id @default(uuid())
  examId      String
  exam        Exam     @relation(fields: [examId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogrenciId   String
  ogrenci     User     @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  puan        Float
  dogru       Int?
  yanlis      Int?
  bos         Int?
  yuzde       Float?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([examId, ogrenciId])
  @@index([ogrenciId])
  @@index([examId])
}

// DevamsÄ±zlÄ±k kayÄ±tlarÄ±
model Devamsizlik {
  id          String   @id @default(uuid())
  ogrenciId   String
  ogrenci     User     @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tarih       DateTime
  aciklama    String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([ogrenciId])
  @@index([courseId])
  @@index([tarih])
}

// MesajlaÅŸma sistemi - KonuÅŸmalar (1-1 ve Grup)
enum ConversationType {
  OZEL       // 1-1 Ã¶zel mesaj
  SINIF      // SÄ±nÄ±f grubu
  OGRETMEN   // Ã–ÄŸretmen grubu (aynÄ± kursta)
  PERSONEL   // Personel grubu (mÃ¼dÃ¼r, sekreter, Ã¶ÄŸretmen)
  OZEL_GRUP  // Ã–zel oluÅŸturulan grup
}

model Conversation {
  id            String           @id @default(uuid())
  tip           ConversationType
  ad            String?          // Grup adÄ± (1-1 iÃ§in null)
  aciklama      String?
  resimUrl      String?
  olusturanId   String?
  
  // SÄ±nÄ±f grubu iÃ§in
  sinifId       String?
  
  uyeler        ConversationMember[]
  mesajlar      Message[]
  
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  @@index([tip])
  @@index([sinifId])
  @@index([createdAt])
}

model ConversationMember {
  id              String       @id @default(uuid())
  conversationId  String
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  userId          String
  user            User         @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  rolAd           String?      // Grup iÃ§i rol: admin, uye
  seslesiz        Boolean      @default(false) // Bildirimleri kapat
  sabitle         Boolean      @default(false) // KonuÅŸmayÄ± sabitle
  sonGorulenMesajId String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
}

model Message {
  id              String        @id @default(uuid())
  conversationId  String
  conversation    Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  gonderenId      String
  gonderen        User          @relation("GonderenMesajlar", fields: [gonderenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Eski 1-1 mesaj sistemi iÃ§in geriye uyumluluk
  alanId          String?
  alan            User?         @relation("AlanMesajlar", fields: [alanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  icerik          String        @db.Text
  baslik          String?
  durum           MessageStatus @default(OKUNMADI)
  
  // Ek Ã¶zellikler
  dosyaUrl        String?
  dosyaTip        String?       // image, document, audio
  yanitladigiMesajId String?    // YanÄ±t verilen mesaj
  duzenlendi      Boolean       @default(false)
  silindi         Boolean       @default(false)
  
  okuyanlar       MessageRead[]
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([conversationId])
  @@index([gonderenId])
  @@index([alanId])
  @@index([durum])
  @@index([createdAt])
}

// Mesaj okunma durumu (grup mesajlarÄ± iÃ§in)
model MessageRead {
  id          String   @id @default(uuid())
  mesajId     String
  mesaj       Message  @relation(fields: [mesajId], references: [id], onDelete: Cascade)
  userId      String
  okunmaTarihi DateTime @default(now())
  
  @@unique([mesajId, userId])
  @@index([mesajId])
  @@index([userId])
}

// Bildirimler
model Notification {
  id          String           @id @default(uuid())
  userId      String
  user        User             @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tip         NotificationType
  baslik      String
  mesaj       String
  okundu      Boolean          @default(false)
  onayTalebi  Boolean          @default(false)
  onayDurumu  String?          // BEKLEMEDE, ONAYLANDI, REDDEDILDI
  ilgiliId    String?          // Onay iÃ§in ilgili kayÄ±t ID'si
  
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([userId])
  @@index([okundu])
  @@index([createdAt])
}

// Yoklama kayÄ±tlarÄ± - Ã–ÄŸretmen tarafÄ±ndan alÄ±nÄ±r
model Yoklama {
  id          String       @id @default(uuid())
  ogrenciId   String
  ogrenci     User         @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  courseId    String
  course      Course       @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tarih       DateTime     @default(now())
  durum       YoklamaDurum
  aciklama    String?
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@unique([ogrenciId, courseId, tarih])
  @@index([ogrenciId])
  @@index([courseId])
  @@index([tarih])
}

// Ã–devler - Ã–ÄŸretmen tarafÄ±ndan verilir
model Odev {
  id              String    @id @default(uuid())
  baslik          String
  aciklama        String?   @db.Text
  courseId        String?   // Opsiyonel - hedefSiniflar kullanÄ±labilir
  course          Course?   @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ogretmenId      String
  ogretmen        User      @relation("OgretmenOdevler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Zamanlama
  baslangicTarihi DateTime? // Ã–devin baÅŸlangÄ±Ã§ tarihi (opsiyonel)
  sonTeslimTarihi DateTime
  maxPuan         Int       @default(100)
  aktif           Boolean   @default(true)
  
  // Taslak Ã¶zelliÄŸi
  taslak          Boolean   @default(false)
  
  // GeÃ§ teslim politikasÄ± (JSON)
  // { aktif: boolean, toleransSuresi: number (saat), puanKesintisi: number (%) }
  gecTeslimPolitikasi String? @db.Text
  
  // Kopyalama referansÄ±
  kopyalananOdevId String?  // Hangi Ã¶devden kopyalandÄ±
  
  // Ã–dev tipi ve iÃ§erik
  odevTipi        OdevTipi  @default(KARISIK)
  konuBasligi     String?   // Konu baÅŸlÄ±ÄŸÄ±
  icerik          String?   @db.Text // Zengin metin iÃ§erik (HTML/Markdown)
  resimler        String?   @db.Text // JSON array - Ã¶dev iÃ§in eklenen resimler
  dosyalar        String?   @db.Text // JSON array - Ã¶dev iÃ§in eklenen dosyalar
  
  // Hedef sÄ±nÄ±flar (course yerine veya ek olarak kullanÄ±labilir)
  hedefSiniflar   String?   @db.Text // JSON array - birden fazla sÄ±nÄ±f ID'si
  
  // Ä°liÅŸkiler
  teslimler       OdevTeslim[]
  sorular         OdevSoru[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([courseId])
  @@index([ogretmenId])
  @@index([sonTeslimTarihi])
  @@index([baslangicTarihi])
  @@index([odevTipi])
  @@index([taslak])
}

// Ã–dev SorularÄ± - Ã–ÄŸretmen klasik sorular ekleyebilir
model OdevSoru {
  id          String   @id @default(uuid())
  odevId      String
  odev        Odev     @relation(fields: [odevId], references: [id], onDelete: Cascade)
  
  siraNo      Int      @default(1)
  soruMetni   String   @db.Text
  resimUrl    String?  // Soru iÃ§in resim (max 8MB)
  puan        Int      @default(10)
  
  // Test sorusu iÃ§in ek alanlar
  soruTipi    String   @default("klasik") // "test" veya "klasik"
  siklar      Json?    // Test sorusu ÅŸÄ±klarÄ± ["A ÅŸÄ±kkÄ±", "B ÅŸÄ±kkÄ±", ...]
  dogruCevap  Int?     // DoÄŸru cevap indeksi (0, 1, 2, 3...)
  
  // Ã–ÄŸrenci cevaplarÄ±
  cevaplar    OdevSoruCevap[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([odevId])
  @@index([siraNo])
}

// Ã–dev Soru CevaplarÄ± - Ã–ÄŸrencinin sorulara verdiÄŸi cevaplar
model OdevSoruCevap {
  id          String    @id @default(uuid())
  soruId      String
  soru        OdevSoru  @relation(fields: [soruId], references: [id], onDelete: Cascade)
  teslimId    String
  teslim      OdevTeslim @relation(fields: [teslimId], references: [id], onDelete: Cascade)
  
  cevapMetni  String?   @db.Text // YazÄ±lÄ± cevap (klasik sorular iÃ§in)
  resimUrl    String?   // Cevap iÃ§in resim (max 8MB)
  secilenSik  Int?      // Test sorusu iÃ§in seÃ§ilen ÅŸÄ±k indeksi (0, 1, 2, 3...)
  dogruMu     Boolean?  // Test sorusu iÃ§in otomatik hesaplanan doÄŸru/yanlÄ±ÅŸ
  puan        Int?      // Verilen puan
  yorum       String?   @db.Text // Ã–ÄŸretmen yorumu
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([soruId, teslimId])
  @@index([soruId])
  @@index([teslimId])
}

// Ã–dev teslimleri - Ã–ÄŸrenci tarafÄ±ndan teslim edilir, Ã–ÄŸretmen tarafÄ±ndan deÄŸerlendirilir
model OdevTeslim {
  id          String    @id @default(uuid())
  odevId      String
  odev        Odev      @relation(fields: [odevId], references: [id], onDelete: Cascade)
  ogrenciId   String
  ogrenci     User      @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teslimTarihi DateTime @default(now())
  
  // Dosya ve aÃ§Ä±klama
  dosyaUrl    String?   // Eski alan - geriye uyumluluk
  dosyalar    String?   @db.Text // JSON array - birden fazla dosya URL [{url, ad, boyut, tip}]
  resimler    String?   @db.Text // JSON array - birden fazla resim URL
  aciklama    String?   @db.Text
  
  // Durum ve deÄŸerlendirme
  durum       OdevDurum @default(BEKLEMEDE)
  puan        Int?
  ogretmenYorumu String? @db.Text
  
  // GeÃ§ teslim bilgisi
  gecTeslimMi     Boolean  @default(false)
  gecikmeGun      Int?     // KaÃ§ gÃ¼n geÃ§ teslim edildi
  puanKesintisi   Float?   // Uygulanan puan kesintisi yÃ¼zdesi
  orijinalPuan    Int?     // Kesinti Ã¶ncesi puan
  
  // Soru cevaplarÄ± iliÅŸkisi
  soruCevaplari OdevSoruCevap[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([odevId, ogrenciId])
  @@index([odevId])
  @@index([ogrenciId])
  @@index([durum])
  @@index([gecTeslimMi])
}

// Duyuru hedef kitlesi
enum DuyuruHedef {
  HERKESE       // TÃ¼m kullanÄ±cÄ±lar
  SINIF         // Belirli sÄ±nÄ±f(lar)
  OGRETMENLER   // TÃ¼m Ã¶ÄŸretmenler
  OGRENCILER    // TÃ¼m Ã¶ÄŸrenciler
  VELILER       // TÃ¼m veliler
  PERSONEL      // MÃ¼dÃ¼r, Ã¶ÄŸretmen, sekreter
}

enum DuyuruOncelik {
  NORMAL
  ONEMLI
  ACIL
}

// Duyuru kategorileri
enum DuyuruKategori {
  GENEL           // Genel duyurular
  AKADEMIK        // Akademik duyurular
  ETKINLIK        // Etkinlik duyurularÄ±
  SINAV           // SÄ±nav duyurularÄ±
  IDARI           // Ä°dari duyurular
  DIGER           // DiÄŸer
}

// Duyurular
model Duyuru {
  id          String        @id @default(uuid())
  baslik      String
  icerik      String        @db.Text
  hedef       DuyuruHedef   @default(HERKESE)
  oncelik     DuyuruOncelik @default(NORMAL)
  kategori    DuyuruKategori @default(GENEL)
  
  // Hedef sÄ±nÄ±flar (hedef SINIF ise)
  sinifIds    String?       // JSON array: ["sinif1-id", "sinif2-id"]
  
  // Dosya eki
  dosyaUrl    String?
  dosyaAd     String?
  
  // OluÅŸturan
  olusturanId String
  olusturan   User          @relation("DuyuruOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Kurs (opsiyonel - sadece o kursa Ã¶zel)
  kursId      String?
  kurs        Kurs?         @relation(fields: [kursId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // YayÄ±n durumu
  aktif       Boolean       @default(true)
  yayinTarihi DateTime      @default(now())
  bitisTarihi DateTime?     // Opsiyonel: Duyurunun sona erme tarihi
  
  // Pinleme ve arÅŸiv
  pinlendi    Boolean       @default(false)
  arsivlendi  Boolean       @default(false)
  arsivTarihi DateTime?
  
  // Okunma takibi
  okuyanlar   DuyuruOkuma[]
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([olusturanId])
  @@index([kursId])
  @@index([hedef])
  @@index([aktif])
  @@index([yayinTarihi])
  @@index([kategori])
  @@index([pinlendi])
  @@index([arsivlendi])
}

// Duyuru okunma takibi
model DuyuruOkuma {
  id          String   @id @default(uuid())
  duyuruId    String
  duyuru      Duyuru   @relation(fields: [duyuruId], references: [id], onDelete: Cascade)
  userId      String
  okunmaTarihi DateTime @default(now())
  
  @@unique([duyuruId, userId])
  @@index([duyuruId])
  @@index([userId])
}

// ================== Ã–DEME SÄ°STEMÄ° ==================

enum OdemeDurum {
  BEKLEMEDE      // Ã–deme bekleniyor
  ODENDI         // Ã–deme yapÄ±ldÄ±
  IPTAL          // Ä°ptal edildi
  IADE           // Ä°ade edildi
  GECIKTI        // GecikmiÅŸ Ã¶deme
}

enum OdemeTip {
  KAYIT          // KayÄ±t Ã¼creti
  TAKSIT         // AylÄ±k taksit
  EK_DERS        // Ek ders Ã¼creti
  MATERYAL       // Materyal Ã¼creti
  DIGER          // DiÄŸer
}

enum OdemeYontemi {
  KREDI_KARTI    // Kredi kartÄ± (iyzico)
  HAVALE         // Havale/EFT
  NAKIT          // Nakit
}

// Ã–deme planlarÄ± (Ã¶ÄŸrenci bazlÄ±)
model OdemePlani {
  id              String   @id @default(uuid())
  ogrenciId       String
  ogrenci         User     @relation("OgrenciOdemePlanlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  donemAd         String   // "2024-2025 GÃ¼z DÃ¶nemi"
  toplamTutar     Float
  taksitSayisi    Int      @default(1)
  taksitTutari    Float
  
  // Ä°ndirim
  indirimOrani    Float?   @default(0)
  indirimTutari   Float?   @default(0)
  
  // OluÅŸturan
  olusturanId     String
  olusturan       User     @relation("OdemePlaniOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aciklama        String?
  aktif           Boolean  @default(true)
  
  odemeler        Odeme[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([ogrenciId])
  @@index([olusturanId])
  @@index([aktif])
}

// Tek tek Ã¶demeler
model Odeme {
  id              String       @id @default(uuid())
  odemePlaniId    String?
  odemePlani      OdemePlani?  @relation(fields: [odemePlaniId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogrenciId       String
  ogrenci         User         @relation("OgrenciOdemeleri", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tip             OdemeTip
  tutar           Float
  durum           OdemeDurum   @default(BEKLEMEDE)
  
  // Taksit bilgisi
  taksitNo        Int?         // 1, 2, 3... (taksitli Ã¶demelerde)
  vadeTarihi      DateTime
  orijinalVadeTarihi DateTime? // Erteleme Ã¶ncesi orijinal vade tarihi
  
  // Taksit erteleme
  ertelendi       Boolean      @default(false)
  ertelemeSayisi  Int          @default(0)
  ertelemeNotu    String?
  
  // Ã–deme bilgisi
  odemeYontemi    OdemeYontemi?
  odemeTarihi     DateTime?
  
  // Kupon kullanÄ±mÄ±
  kuponId         String?
  kupon           IndirimKuponu? @relation(fields: [kuponId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  kuponIndirimi   Float?       // Uygulanan kupon indirimi
  
  // iyzico bilgileri
  iyzicoPaymentId String?      // iyzico Ã¶deme ID
  iyzicoConversationId String? // iyzico konuÅŸma ID
  
  // Onaylayan
  onaylayanId     String?
  onaylayan       User?        @relation("OdemeOnaylayan", fields: [onaylayanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aciklama        String?
  
  // Makbuz bilgisi
  makbuzNo        String?      @unique
  makbuzUrl       String?      // PDF makbuz URL'i
  
  // HatÄ±rlatma
  hatirlatimaGonderildi Boolean @default(false)
  sonHatirlatmaTarihi   DateTime?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([odemePlaniId])
  @@index([ogrenciId])
  @@index([durum])
  @@index([vadeTarihi])
  @@index([kuponId])
  @@index([makbuzNo])
}

// Ä°ndirim KuponlarÄ±
model IndirimKuponu {
  id              String       @id @default(uuid())
  kod             String       @unique
  aciklama        String?
  
  // Ä°ndirim tipi
  indirimTipi     String       @default("YUZDE") // YUZDE veya TUTAR
  indirimDegeri   Float        // YÃ¼zde veya sabit tutar
  
  // KullanÄ±m limitleri
  kullanimLimiti  Int?         // null = sÄ±nÄ±rsÄ±z
  kullanilanAdet  Int          @default(0)
  
  // GeÃ§erlilik
  baslangicTarihi DateTime     @default(now())
  bitisTarihi     DateTime?
  aktif           Boolean      @default(true)
  
  // Minimum tutar
  minTutar        Float?       // Minimum Ã¶deme tutarÄ±
  
  // Kurs bazlÄ± (opsiyonel)
  kursId          String?
  
  odemeler        Odeme[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  @@index([kod])
  @@index([aktif])
  @@index([bitisTarihi])
  @@index([kursId])
}

// Ã–deme HatÄ±rlatmalarÄ±
model OdemeHatirlama {
  id              String       @id @default(uuid())
  ogrenciId       String
  odemePlaniId    String?
  
  // HatÄ±rlatma tipi
  tip             String       // YAKLASAN, GECIKEN, GENEL
  
  // ZamanlanmÄ±ÅŸ gÃ¶nderim
  gonderimTarihi  DateTime
  gonderildiMi    Boolean      @default(false)
  gonderimZamani  DateTime?
  
  // Ä°Ã§erik
  baslik          String
  mesaj           String       @db.Text
  
  // Kanal
  emailGonderilsin Boolean     @default(true)
  pushGonderilsin  Boolean     @default(true)
  smsGonderilsin   Boolean     @default(false)
  
  createdAt       DateTime     @default(now())
  
  @@index([gonderimTarihi])
  @@index([gonderildiMi])
  @@index([ogrenciId])
}

// ================== CANLI DERS SÄ°STEMÄ° ==================

enum CanliDersDurum {
  PLANLANMIS     // HenÃ¼z baÅŸlamadÄ±
  AKTIF          // Åu an devam ediyor
  SONA_ERDI      // Bitti
  IPTAL          // Ä°ptal edildi
}

// CanlÄ± Dersler (Jitsi Meet entegrasyonu)
model CanliDers {
  id              String           @id @default(uuid())
  baslik          String
  aciklama        String?          @db.Text
  
  courseId        String
  course          Course           @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogretmenId      String
  ogretmen        User             @relation("OgretmenCanliDersler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Zamanlama
  baslangicTarihi DateTime
  bitisTarihi     DateTime
  
  // Jitsi bilgileri
  odaAdi          String           @unique  // Jitsi room name
  odaSifresi      String?                   // Opsiyonel ÅŸifre
  
  // Ayarlar
  kayitYapilsin   Boolean          @default(false)  // Dersi kaydet
  mikrofonAcik    Boolean          @default(false)  // Ã–ÄŸrenciler mikrofon aÃ§abilir
  kameraAcik      Boolean          @default(false)  // Ã–ÄŸrenciler kamera aÃ§abilir
  sohbetAcik      Boolean          @default(true)   // Sohbet aktif
  
  durum           CanliDersDurum   @default(PLANLANMIS)
  
  katilimlar      CanliDersKatilim[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([courseId])
  @@index([ogretmenId])
  @@index([durum])
  @@index([baslangicTarihi])
}

// CanlÄ± Ders KatÄ±lÄ±m Takibi
model CanliDersKatilim {
  id              String      @id @default(uuid())
  canliDersId     String
  canliDers       CanliDers   @relation(fields: [canliDersId], references: [id], onDelete: Cascade)
  
  ogrenciId       String
  ogrenci         User        @relation("OgrenciCanliDersKatilimlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  girisZamani     DateTime    @default(now())
  cikisZamani     DateTime?
  
  // Ä°statistik
  toplamSure      Int?        // dakika cinsinden
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([canliDersId])
  @@index([ogrenciId])
  @@index([girisZamani])
}

// ================== ONLÄ°NE SINAV SÄ°STEMÄ° ==================

enum SoruTipi {
  COKTAN_SECMELI   // A, B, C, D, E
  DOGRU_YANLIS     // DoÄŸru / YanlÄ±ÅŸ
  ACIK_UCLU        // YazÄ±lÄ± cevap
  ESLESTIRME       // EÅŸleÅŸtirme
}

enum OnlineSinavDurum {
  TASLAK           // HenÃ¼z yayÄ±nlanmadÄ±
  AKTIF            // Ã–ÄŸrenciler girebilir
  SONA_ERDI        // SÃ¼re doldu
  IPTAL            // Ä°ptal edildi
}

// Online SÄ±nav
model OnlineSinav {
  id              String           @id @default(uuid())
  baslik          String
  aciklama        String?          @db.Text
  
  // Ders baÄŸlantÄ±sÄ± - opsiyonel (branÅŸ bazlÄ± denemeler iÃ§in courseId olmayabilir)
  courseId        String?
  course          Course?          @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // BranÅŸ/Ders adÄ± (deneme sÄ±navlarÄ± iÃ§in)
  dersAdi         String?
  bransKodu       String?
  
  // Hedef sÄ±nÄ±flar (JSON array: ["sinif-id-1", "sinif-id-2"])
  // BoÅŸsa tÃ¼m sÄ±nÄ±flara aÃ§Ä±k
  hedefSiniflar   String?          @db.Text
  
  ogretmenId      String
  ogretmen        User             @relation("OgretmenOnlineSinavlar", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // SÄ±nav AyarlarÄ±
  sure            Int              // dakika cinsinden
  maksimumPuan    Float            @default(100)
  baslangicTarihi DateTime
  bitisTarihi     DateTime
  
  // Kurallar
  karistir        Boolean          @default(true)  // SorularÄ± karÄ±ÅŸtÄ±r
  geriDonus       Boolean          @default(false) // Ã–nceki soruya dÃ¶nebilir mi
  sonucGoster     Boolean          @default(true)  // Bitince sonucu gÃ¶ster
  
  durum           OnlineSinavDurum @default(TASLAK)
  
  sorular         OnlineSoru[]
  oturumlar       SinavOturumu[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([courseId])
  @@index([ogretmenId])
  @@index([bransKodu])
  @@index([durum])
  @@index([baslangicTarihi])
}

// SÄ±nav SorularÄ±
model OnlineSoru {
  id              String       @id @default(uuid())
  sinavId         String
  sinav           OnlineSinav  @relation(fields: [sinavId], references: [id], onDelete: Cascade)
  
  soruMetni       String       @db.Text
  soruTipi        SoruTipi     @default(COKTAN_SECMELI)
  puan            Int          @default(10)
  siraNo          Int
  
  // Ã‡oktan seÃ§meli iÃ§in seÃ§enekler (JSON array)
  secenekler      String?      @db.Text  // ["A ÅŸÄ±kkÄ±", "B ÅŸÄ±kkÄ±", "C ÅŸÄ±kkÄ±", "D ÅŸÄ±kkÄ±"]
  dogruCevap      String                 // "A" veya "DOGRU" veya aÃ§Ä±k uÃ§lu iÃ§in cevap
  
  // GÃ¶rsel (opsiyonel)
  resimUrl        String?      @db.Text
  
  cevaplar        SinavCevap[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([sinavId])
  @@index([siraNo])
}

// SÄ±nav Oturumu (Ã¶ÄŸrenci sÄ±nava girdiÄŸinde)
model SinavOturumu {
  id              String       @id @default(uuid())
  sinavId         String
  sinav           OnlineSinav  @relation(fields: [sinavId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogrenciId       String
  ogrenci         User         @relation("OgrenciSinavOturumlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  baslangicZamani DateTime     @default(now())
  bitisZamani     DateTime?
  
  // SonuÃ§
  toplamPuan      Int?
  dogruSayisi     Int?
  yanlisSayisi    Int?
  bosSayisi       Int?
  yuzde           Float?
  
  // Soru sÄ±rasÄ± (karÄ±ÅŸtÄ±rÄ±ldÄ±ysa)
  soruSirasi      String?      @db.Text  // JSON array: ["soru-id-1", "soru-id-3", "soru-id-2"]
  
  tamamlandi      Boolean      @default(false)
  
  cevaplar        SinavCevap[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([sinavId, ogrenciId])
  @@index([sinavId])
  @@index([ogrenciId])
  @@index([tamamlandi])
}

// Ã–ÄŸrenci CevaplarÄ±
model SinavCevap {
  id              String        @id @default(uuid())
  oturumId        String
  oturum          SinavOturumu  @relation(fields: [oturumId], references: [id], onDelete: Cascade)
  
  soruId          String
  soru            OnlineSoru    @relation(fields: [soruId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  cevap           String?       // Ã–ÄŸrencinin verdiÄŸi cevap
  dogruMu         Boolean?      // Otomatik deÄŸerlendirme sonucu
  alinanPuan      Int?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@unique([oturumId, soruId])
  @@index([oturumId])
  @@index([soruId])
}

// ================== MATERYAL PAYLAÅIMI ==================

enum MateryalTipi {
  PDF
  VIDEO
  RESIM
  BELGE
  SUNUM
  DIGER
}

model Materyal {
  id              String        @id @default(uuid())
  baslik          String
  aciklama        String?       @db.Text
  
  courseId        String
  course          Course        @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  yukleyenId      String
  yukleyen        User          @relation("MateryalYukleyen", fields: [yukleyenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tip             MateryalTipi
  dosyaUrl        String
  dosyaAdi        String
  dosyaBoyutu     Int?          // byte cinsinden
  
  indirmeSayisi   Int           @default(0)
  aktif           Boolean       @default(true)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([courseId])
  @@index([yukleyenId])
  @@index([tip])
}

// ================== BÄ°REBÄ°R DERS SÄ°STEMÄ° ==================

enum BirebirDersDurum {
  PLANLANMIS
  TAMAMLANDI
  IPTAL
  GELMEDI
}

// Ã–ÄŸrenci saat paketi
model BirebirDersPaketi {
  id              String    @id @default(uuid())
  ogrenciId       String
  ogrenci         User      @relation("OgrenciBirebirPaketleri", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  toplamSaat      Int       // SatÄ±n alÄ±nan toplam saat
  kullanilanSaat  Int       @default(0)
  kalanSaat       Int       // Computed: toplamSaat - kullanilanSaat
  
  fiyat           Float?    // Paket fiyatÄ±
  baslangicTarihi DateTime  @default(now())
  bitisTarihi     DateTime? // Paketin geÃ§erlilik sÃ¼resi
  
  aktif           Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([ogrenciId])
  @@index([aktif])
}

// Birebir ders randevularÄ±
model BirebirDers {
  id              String           @id @default(uuid())
  
  ogretmenId      String
  ogretmen        User             @relation("OgretmenBirebirDersler", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  ogrenciId       String
  ogrenci         User             @relation("OgrenciBirebirDersler", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  konu            String?          // Ders konusu
  aciklama        String?          @db.Text
  
  tarih           DateTime
  baslangicSaati  String           // "14:00"
  bitisSaati      String           // "15:00"
  sure            Int              @default(60) // dakika
  
  durum           BirebirDersDurum @default(PLANLANMIS)
  
  // Jitsi odasÄ±
  odaAdi          String?          @unique
  
  // Notlar
  ogretmenNotu    String?          @db.Text
  ogrenciNotu     String?          @db.Text
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([ogretmenId])
  @@index([ogrenciId])
  @@index([tarih])
  @@index([durum])
}

// ================== HARÄ°CÄ° DENEME SINAVI SÄ°STEMÄ° ==================

enum DenemeTuru {
  TYT          // Temel Yeterlilik Testi (Lise)
  AYT          // Alan Yeterlilik Testi (Lise)
  LGS          // Liselere GeÃ§iÅŸ SÄ±navÄ± (Ortaokul)
  YDT          // YabancÄ± Dil Testi
  KURUM_ICI    // Kurum iÃ§i deneme
}

enum DenemeBrans {
  // TYT BranÅŸlarÄ± (120 soru)
  TYT_TURKCE        // 40 soru
  TYT_MATEMATIK     // 40 soru
  // Sosyal Bilimler (20 soru)
  TYT_TARIH         // 5 soru
  TYT_COGRAFYA      // 5 soru
  TYT_FELSEFE       // 5 soru
  TYT_DIN           // 5 soru
  // Fen Bilimleri (20 soru)
  TYT_FIZIK         // 7 soru
  TYT_KIMYA         // 7 soru
  TYT_BIYOLOJI      // 6 soru
  
  // AYT BranÅŸlarÄ± (160 soru)
  AYT_MATEMATIK     // 40 soru
  // Fen Bilimleri (40 soru)
  AYT_FIZIK         // 14 soru
  AYT_KIMYA         // 13 soru
  AYT_BIYOLOJI      // 13 soru
  // Edebiyat-Sosyal 1 (40 soru)
  AYT_EDEBIYAT      // 24 soru
  AYT_TARIH1        // 10 soru
  AYT_COGRAFYA1     // 6 soru
  // Sosyal Bilimler 2 (40 soru)
  AYT_TARIH2        // 11 soru
  AYT_COGRAFYA2     // 11 soru
  AYT_FELSEFE       // 12 soru
  AYT_DIN           // 6 soru
  
  // LGS BranÅŸlarÄ± (90 soru)
  LGS_TURKCE        // 20 soru
  LGS_MATEMATIK     // 20 soru
  LGS_FEN           // 20 soru
  LGS_INKILAP       // 10 soru (T.C. Ä°nkÄ±lap Tarihi ve AtatÃ¼rkÃ§Ã¼lÃ¼k)
  LGS_DIN           // 10 soru
  LGS_INGILIZCE     // 10 soru
  
  // YabancÄ± Dil Testleri
  YDT_INGILIZCE
  YDT_ALMANCA
  YDT_FRANSIZCA
}

// Deneme SÄ±navÄ± (Ana kayÄ±t - harici kurumlardan gelen)
model DenemeSinavi {
  id              String       @id @default(uuid())
  ad              String       // "KasÄ±m TYT Denemesi 1", "LGS Genel Deneme 3"
  tur             DenemeTuru   // TYT, AYT, LGS
  kurum           String?      // "Bilgi Sarmal", "Limit", "Kanguru", kurum iÃ§i iÃ§in null
  
  tarih           DateTime
  
  // Hedef kitle
  sinifId         String?      // Belirli sÄ±nÄ±f iÃ§in (null = tÃ¼m sÄ±nÄ±flar) [Eski sistem - uyumluluk iÃ§in]
  sinif           Sinif?       @relation("DenemeSinavSinif", fields: [sinifId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  hedefSiniflar   String?      // JSON array: [5, 6, 7, 8] veya [9, 10, 11, 12] - SÄ±nÄ±f seviyeleri
  kursId          String?      // Belirli kurs iÃ§in (null = tÃ¼m kurslar)
  
  // BranÅŸ bazlÄ± soru sayÄ±larÄ± (JSON)
  // Ã–rnek TYT: {"TYT_TURKCE": 40, "TYT_MATEMATIK": 40, "TYT_SOSYAL": 20, "TYT_FEN": 20}
  // Ã–rnek LGS: {"LGS_TURKCE": 20, "LGS_MATEMATIK": 20, "LGS_FEN": 20, "LGS_SOSYAL": 10, "LGS_DIN": 10, "LGS_INGILIZCE": 10}
  branslarVeSoruSayilari String @db.Text
  
  aciklama        String?      @db.Text
  
  // OluÅŸturan
  olusturanId     String
  olusturan       User         @relation("DenemeSinavOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aktif           Boolean      @default(true)
  
  sonuclar        DenemeSonucu[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([tur])
  @@index([tarih])
  @@index([sinifId])
  @@index([kursId])
  @@index([olusturanId])
}

// Deneme Sonucu (Ã–ÄŸrenci bazlÄ±, branÅŸ bazlÄ± detaylar)
model DenemeSonucu {
  id              String        @id @default(uuid())
  sinavId         String
  sinav           DenemeSinavi  @relation(fields: [sinavId], references: [id], onDelete: Cascade)
  
  ogrenciId       String
  ogrenci         User          @relation("OgrenciDenemeSonuclari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // BranÅŸ bazlÄ± sonuÃ§lar (JSON)
  // Her branÅŸ iÃ§in: dogru, yanlis, bos, net, soruSayisi
  // Ã–rnek: {"TYT_TURKCE": {"dogru": 30, "yanlis": 8, "bos": 2, "net": 28, "soruSayisi": 40}}
  branslarVeSonuclar String     @db.Text
  
  // Genel sonuÃ§lar (hesaplanan)
  toplamDogru     Int
  toplamYanlis    Int
  toplamBos       Int
  toplamNet       Float        // Toplam net (tÃ¼m branÅŸlar)
  genelPuan       Float?       // 500 puan hesaplamasÄ± (opsiyonel)
  
  // SÄ±ralamalar (opsiyonel)
  sinifSirasi     Int?
  kursSirasi      Int?
  genelSiralama   Int?         // TÃ¼m katÄ±lÄ±mcÄ±lar arasÄ±nda
  
  // SonuÃ§ giren
  girenId         String?
  giren           User?        @relation("DenemeSonucuGiren", fields: [girenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  aciklama        String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([sinavId, ogrenciId])
  @@index([sinavId])
  @@index([ogrenciId])
  @@index([toplamNet])
  @@index([girenId])
}

// Ã–ÄŸrenci Deneme Hedefleri
model DenemeHedef {
  id              String       @id @default(uuid())
  ogrenciId       String
  ogrenci         User         @relation(fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Hedef tÃ¼rÃ¼ (TYT, AYT, LGS)
  tur             DenemeTuru
  
  // Hedef net (toplam)
  hedefNet        Float
  
  // BranÅŸ bazlÄ± hedef netler (JSON)
  // Ã–rnek: {"TYT_TURKCE": 30, "TYT_MATEMATIK": 25}
  bransHedefleri  String?      @db.Text
  
  // Hedef sÄ±ralama
  hedefSiralama   Int?
  
  // Hedef tarih
  hedefTarihi     DateTime?    // Bu tarihe kadar hedefe ulaÅŸma
  
  // Ä°lerleme takibi
  sonNet          Float?       // En son deneme neti
  sonSiralama     Int?         // En son sÄ±ralama
  ilerlemeDurumu  String?      // YUKSELIYOR, DUSUYOR, STABIL
  
  aktif           Boolean      @default(true)
  aciklama        String?
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  @@unique([ogrenciId, tur])
  @@index([ogrenciId])
  @@index([tur])
  @@index([aktif])
}

// ================== GAMÄ°FÄ°CATÄ°ON SÄ°STEMÄ° ==================

// XP Seviyeleri (CS:GO tarzÄ±)
enum XPSeviye {
  BASLANGIC     // 0-999 XP (Gri rozet)
  CIRAK         // 1000-4999 XP (Bronz rozet)
  USTA          // 5000-14999 XP (GÃ¼mÃ¼ÅŸ rozet)
  UZMAN         // 15000-29999 XP (AltÄ±n rozet)
  EFSANE        // 30000+ XP (Elmas rozet)
}

enum RozetTipi {
  // Streak Rozetleri ğŸ”¥
  STREAK_7         // 7 gÃ¼n Ã¼st Ã¼ste aktif
  STREAK_30        // 30 gÃ¼n Ã¼st Ã¼ste aktif
  STREAK_100       // 100 gÃ¼n Ã¼st Ã¼ste aktif (Streak UstasÄ±)
  STREAK_365       // 365 gÃ¼n Ã¼st Ã¼ste aktif (YÄ±llÄ±k Efsane)
  
  // Ã–dev Rozetleri ğŸ“š
  ILK_ODEV         // Ä°lk Ã¶dev teslimi
  ODEV_10          // 10 Ã¶dev teslimi
  ODEV_50          // 50 Ã¶dev teslimi (Ã–dev UstasÄ±)
  ODEV_100         // 100 Ã¶dev teslimi
  
  // SÄ±nav Rozetleri ğŸ†
  ILK_SINAV        // Ä°lk sÄ±nav tamamlandÄ±
  SINAV_90         // Bir sÄ±navda %90+ (SÄ±nav Åampiyonu)
  SINAV_100        // Bir sÄ±navda %100 (MÃ¼kemmeliyetÃ§i)
  SINAV_10         // 10 sÄ±nav tamamlandÄ±
  
  // Zaman Rozetleri â°
  ERKEN_KUS        // Sabah 06:00-08:00 arasÄ± 10 gÃ¶rev
  GECE_KUSU        // Gece 22:00-00:00 arasÄ± 10 gÃ¶rev
  HAFTA_SONU       // Hafta sonu 20 gÃ¶rev tamamladÄ±
  
  // Sosyal Rozetler ğŸ’¬
  SOSYAL_KELEBEK   // 50 mesaj gÃ¶nder
  YARDIMCI         // 10 arkadaÅŸÄ±na yardÄ±m et
  
  // CanlÄ± Ders Rozetleri ğŸ¥
  CANLI_DERS_10    // 10 canlÄ± derse katÄ±l
  CANLI_DERS_50    // 50 canlÄ± derse katÄ±l (CanlÄ± Ders UstasÄ±)
  
  // XP Rozetleri â­
  XP_1000          // 1000 XP topla
  XP_5000          // 5000 XP topla
  XP_10000         // 10000 XP topla
  XP_25000         // 25000 XP topla
  XP_50000         // 50000 XP topla (XP KralÄ±)
  
  // GÃ¼nÃ¼n Sorusu Rozetleri â“
  GUN_SORUSU_7     // 7 gÃ¼n Ã¼st Ã¼ste gÃ¼nÃ¼n sorusunu Ã§Ã¶z
  GUN_SORUSU_30    // 30 gÃ¼n Ã¼st Ã¼ste gÃ¼nÃ¼n sorusunu Ã§Ã¶z
  GUN_SORUSU_DOGRU_10 // 10 gÃ¼nÃ¼n sorusunu doÄŸru cevapla
  
  // HÄ±z Rozetleri âš¡
  HIZ_SAMPIYONU    // Bir sÄ±navÄ± en hÄ±zlÄ± bitiren
  ERKEN_TESLIM     // 10 Ã¶devi son tarihten 3+ gÃ¼n Ã¶nce teslim et
  
  // Ã–zel Rozetler ğŸŒŸ
  SISTEM_MIMARI    // TÃ¼m modÃ¼lleri kullandÄ±
  BETA_TESTER      // Beta test sÃ¼recine katÄ±ldÄ±
  KUSURSUZ_HAFTA   // 1 hafta boyunca tÃ¼m gÃ¶revleri tamamladÄ±
}

model Rozet {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tip             RozetTipi
  kazanilanTarih  DateTime  @default(now())
  
  // Rozet kazanÄ±ldÄ±ÄŸÄ±nda verilen XP
  kazanilanXp     Int       @default(50)
  
  // Ã–ÄŸretmen tarafÄ±ndan Ã¶dÃ¼llendirildi mi?
  ogretmenOdullendirdi Boolean @default(false)
  odullendirmeTarihi   DateTime?
  odullendirmeNotu     String?  @db.Text
  
  createdAt       DateTime  @default(now())

  @@unique([userId, tip])
  @@index([userId])
  @@index([ogretmenOdullendirdi])
}

enum GorevTipi {
  SORU_COZ       // X soru Ã§Ã¶z
  KONU_BITIR     // X konu bitir
  ODEV_TESLIM    // Ã–dev teslim et
  CANLI_DERS     // CanlÄ± derse katÄ±l
  GUN_SORUSU     // GÃ¼nÃ¼n sorusunu Ã§Ã¶z
  MATERYAL_INCELE // Materyal incele
}

model GunlukGorev {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  tarih           DateTime  @db.Date
  tip             GorevTipi
  hedef           Int       // Hedef miktar (10 soru, 1 Ã¶dev vs)
  ilerleme        Int       @default(0) // Mevcut ilerleme
  tamamlandi      Boolean   @default(false)
  xpOdulu         Int       @default(10)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([userId, tarih, tip])
  @@index([userId])
  @@index([tarih])
}

// Soru Havuzu (GÃ¼nÃ¼n sorusu iÃ§in kaynak - Ã–ÄŸretmenler tarafÄ±ndan eklenir)
model SoruHavuzu {
  id              String    @id @default(uuid())
  
  soruMetni       String    @db.Text
  secenekler      String    @db.Text  // JSON array: ["A ÅŸÄ±kkÄ±", "B ÅŸÄ±kkÄ±", "C ÅŸÄ±kkÄ±", "D ÅŸÄ±kkÄ±"]
  dogruCevap      String    // A, B, C, D
  aciklama        String?   @db.Text  // Ã‡Ã¶zÃ¼m aÃ§Ä±klamasÄ±
  
  // Ã–ÄŸretmen tarafÄ±ndan eklendi
  ekleyenId       String?
  ekleyen         User?     @relation("OgretmenSorulari", fields: [ekleyenId], references: [id], onDelete: SetNull)
  
  // Kategoriler
  konu            String    // Matematik, Fizik, TÃ¼rkÃ§e, Tarih, CoÄŸrafya, Biyoloji, Kimya, Ä°ngilizce
  altKonu         String?   // Alt konu (Trigonometri, Denklemler, vb.)
  
  // Hedef sÄ±nÄ±flar (JSON array: [5, 6, 7, 8] veya [9, 10, 11, 12] gibi)
  hedefSiniflar   String?   @db.Text  // JSON array
  sinifSeviyesi   Int?      // Minimum sÄ±nÄ±f seviyesi (5-12 arasÄ±)
  
  // Zorluk (1-5 arasÄ±)
  zorluk          Int       @default(3) // 1: Ã‡ok Kolay, 2: Kolay, 3: Orta, 4: Zor, 5: Ã‡ok Zor
  
  // Ä°statistikler
  sorulmaSayisi   Int       @default(0)
  dogruCevapSayisi Int      @default(0)
  basariOrani     Float?    // Otomatik hesaplanÄ±r
  
  aktif           Boolean   @default(true)
  onaylandiMi     Boolean   @default(true) // MÃ¼dÃ¼r onayÄ± gerekebilir
  
  // GÃ¼nÃ¼n sorusu olarak seÃ§ildiÄŸinde
  gununSorulari   GununSorusu[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([konu])
  @@index([zorluk])
  @@index([sinifSeviyesi])
  @@index([aktif])
  @@index([ekleyenId])
}

// GÃ¼nÃ¼n sorusu (Her gÃ¼n, her sÄ±nÄ±f seviyesi iÃ§in ayrÄ± soru)
// Ã–rnek: 6 Ocak 2026 - 8. sÄ±nÄ±f iÃ§in Matematik sorusu
model GununSorusu {
  id              String      @id @default(uuid())
  tarih           DateTime    @db.Date
  
  // SÄ±nÄ±f seviyesi (5-12 arasÄ±)
  sinifSeviyesi   Int         // 5, 6, 7, 8, 9, 10, 11, 12
  
  // Soru havuzundan referans
  soruHavuzuId    String?
  soruHavuzu      SoruHavuzu? @relation(fields: [soruHavuzuId], references: [id], onDelete: SetNull)
  
  // Soru iÃ§eriÄŸi (havuzdan kopyalanÄ±r veya Ã¶zel yazÄ±lÄ±r)
  soruMetni       String      @db.Text
  secenekler      String      @db.Text  // JSON array
  dogruCevap      String
  aciklama        String?     @db.Text  // Ã‡Ã¶zÃ¼m aÃ§Ä±klamasÄ±
  
  zorluk          Int         @default(3) // 1-5 arasÄ±
  xpOdulu         Int         @default(15) // ZorluÄŸa gÃ¶re: 10, 15, 20, 30, 50
  konu            String?     // Matematik, Fizik, vs.
  
  cevaplar        GununSorusuCevap[]
  
  createdAt       DateTime    @default(now())
  
  // Her gÃ¼n her sÄ±nÄ±f seviyesi iÃ§in sadece 1 soru
  @@unique([tarih, sinifSeviyesi])
  @@index([soruHavuzuId])
  @@index([konu])
  @@index([sinifSeviyesi])
  @@index([tarih])
}

model GununSorusuCevap {
  id              String       @id @default(uuid())
  gununSorusuId   String
  gununSorusu     GununSorusu  @relation(fields: [gununSorusuId], references: [id], onDelete: Cascade)
  
  userId          String
  user            User         @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  cevap           String
  dogruMu         Boolean
  ipucuKullanildi Boolean      @default(false)
  kazanilanXp     Int
  
  createdAt       DateTime     @default(now())

  @@unique([gununSorusuId, userId])
  @@index([gununSorusuId])
  @@index([userId])
}

// ================== ADMÄ°N SÄ°STEM YÃ–NETÄ°MÄ° ==================

enum AdminDuyuruOncelik {
  NORMAL
  ONEMLI
  ACIL
}

// Admin Sistem DuyurularÄ± (Admin -> MÃ¼dÃ¼rler)
model AdminDuyuru {
  id              String              @id @default(uuid())
  baslik          String
  icerik          String              @db.Text
  oncelik         AdminDuyuruOncelik  @default(NORMAL)
  
  // Dosya eki
  dosyaUrl        String?
  dosyaAd         String?
  
  aktif           Boolean             @default(true)
  yayinTarihi     DateTime            @default(now())
  bitisTarihi     DateTime?           // Duyurunun sona erme tarihi
  
  // Okunma takibi
  okuyanlar       AdminDuyuruOkuma[]
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([aktif])
  @@index([yayinTarihi])
  @@index([oncelik])
}

// Admin Duyuru Okunma Takibi
model AdminDuyuruOkuma {
  id              String       @id @default(uuid())
  adminDuyuruId   String
  adminDuyuru     AdminDuyuru  @relation(fields: [adminDuyuruId], references: [id], onDelete: Cascade)
  userId          String
  okunmaTarihi    DateTime     @default(now())
  
  @@unique([adminDuyuruId, userId])
  @@index([adminDuyuruId])
  @@index([userId])
}

// Sistem GÃ¼ncellemeleri / Changelog
enum ChangelogTip {
  YENI_OZELLIK    // Yeni Ã¶zellik eklendi
  IYILESTIRME     // Mevcut Ã¶zellik iyileÅŸtirildi
  HATA_DUZELTME   // Bug fix
  GUVENLIK        // GÃ¼venlik gÃ¼ncellemesi
  PERFORMANS      // Performans iyileÅŸtirmesi
}

model Changelog {
  id              String        @id @default(uuid())
  versiyon        String        // "1.2.0", "2.0.0"
  baslik          String
  aciklama        String        @db.Text
  tip             ChangelogTip  @default(YENI_OZELLIK)
  
  // DetaylÄ± deÄŸiÅŸiklikler (JSON array)
  degisiklikler   String?       @db.Text  // ["Ã–zellik 1 eklendi", "Bug dÃ¼zeltildi"]
  
  yayinTarihi     DateTime      @default(now())
  aktif           Boolean       @default(true)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([yayinTarihi])
  @@index([aktif])
  @@index([tip])
}

// Destek Talebi / Ticket Sistemi
enum DestekTalebiDurum {
  ACIK            // Yeni aÃ§Ä±lan talep
  INCELENIYOR     // Admin inceleniyor
  CEVAPLANDI      // Admin cevapladÄ±
  BEKLEMEDE       // MÃ¼dÃ¼rden cevap bekleniyor
  COZULDU         // Ã‡Ã¶zÃ¼ldÃ¼
  KAPATILDI       // KapatÄ±ldÄ±
}

enum DestekTalebiKategori {
  TEKNIK          // Teknik sorun
  OZELLIK_TALEBI  // Yeni Ã¶zellik talebi
  FATURA          // Fatura/Ã¶deme
  HESAP           // Hesap sorunlarÄ±
  DIGER           // DiÄŸer
}

enum DestekTalebiOncelik {
  DUSUK
  NORMAL
  YUKSEK
  ACIL
}

model DestekTalebi {
  id              String                  @id @default(uuid())
  baslik          String
  aciklama        String                  @db.Text
  
  kategori        DestekTalebiKategori    @default(TEKNIK)
  oncelik         DestekTalebiOncelik     @default(NORMAL)
  durum           DestekTalebiDurum       @default(ACIK)
  
  // Talep aÃ§an
  acanId          String
  kursId          String?                 // Hangi kurs adÄ±na (opsiyonel)
  
  // Dosya eki
  dosyaUrl        String?
  dosyaAd         String?
  
  // Ã‡Ã¶zÃ¼m notlarÄ±
  cozumNotu       String?                 @db.Text
  kapatmaTarihi   DateTime?
  
  cevaplar        DestekTalebiCevap[]
  
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  @@index([acanId])
  @@index([kursId])
  @@index([durum])
  @@index([kategori])
  @@index([oncelik])
  @@index([createdAt])
}

// Destek Talebi CevaplarÄ±
model DestekTalebiCevap {
  id              String        @id @default(uuid())
  talepId         String
  talep           DestekTalebi  @relation(fields: [talepId], references: [id], onDelete: Cascade)
  
  cevaplayanId    String
  icerik          String        @db.Text
  
  // Dosya eki
  dosyaUrl        String?
  dosyaAd         String?
  
  // Admin mi, mÃ¼dÃ¼r mÃ¼ yazdÄ±
  adminYazdiMi    Boolean       @default(false)
  
  createdAt       DateTime      @default(now())

  @@index([talepId])
  @@index([cevaplayanId])
  @@index([createdAt])
}

// YardÄ±m Merkezi / FAQ
enum FAQKategori {
  GENEL           // Genel sorular
  HESAP           // Hesap iÅŸlemleri
  OGRENCI         // Ã–ÄŸrenci yÃ¶netimi
  OGRETMEN        // Ã–ÄŸretmen yÃ¶netimi
  DERS            // Ders/sÄ±nÄ±f yÃ¶netimi
  ODEME           // Ã–deme iÅŸlemleri
  SINAV           // SÄ±nav sistemi
  CANLI_DERS      // CanlÄ± ders
  MESAJLASMA      // MesajlaÅŸma
  TEKNIK          // Teknik sorular
}

model FAQ {
  id              String       @id @default(uuid())
  soru            String
  cevap           String       @db.Text
  kategori        FAQKategori  @default(GENEL)
  siraNo          Int          @default(0)  // GÃ¶rÃ¼ntÃ¼leme sÄ±rasÄ±
  
  // SEO ve arama iÃ§in
  anahtarKelimeler String?     // "Ã¶ÄŸrenci, ekleme, kayÄ±t"
  
  // Ä°statistik
  goruntulemeSayisi Int        @default(0)
  faydaliSayisi     Int        @default(0)  // FaydalÄ± buldum
  
  aktif           Boolean      @default(true)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([kategori])
  @@index([aktif])
  @@index([siraNo])
}

// ================== KURUM Ä°Ã‡Ä° DENEME SINAVI SÄ°STEMÄ° ==================

enum KurumIciDenemeDurum {
  HAZIRLANIYOR    // Ã–ÄŸretmenler soru hazÄ±rlÄ±yor
  ONAY_BEKLIYOR   // MÃ¼dÃ¼r onayÄ± bekliyor
  AKTIF           // YayÄ±nda, Ã¶ÄŸrenciler Ã§Ã¶zebilir
  TAMAMLANDI      // SÄ±nav sÃ¼resi doldu
  IPTAL           // Ä°ptal edildi
}

// Kurum Ä°Ã§i Deneme SÄ±navÄ± (MÃ¼dÃ¼r tarafÄ±ndan baÅŸlatÄ±lÄ±r)
model KurumIciDeneme {
  id              String       @id @default(uuid())
  ad              String       // "2024 Ocak LGS Denemesi"
  tur             DenemeTuru   // TYT, AYT, LGS
  
  // Hedef sÄ±nÄ±flar (JSON array)
  // Ã–rnek: ["9-A", "9-B", "10-A"] veya ["8-A", "8-B"] LGS iÃ§in
  hedefSiniflar   String       @db.Text
  
  // SÄ±nav zamanlamasÄ±
  baslangicTarihi DateTime
  bitisTarihi     DateTime
  sure            Int          // dakika cinsinden toplam sÃ¼re
  
  // Durum
  durum           KurumIciDenemeDurum @default(HAZIRLANIYOR)
  
  // OluÅŸturan (MÃ¼dÃ¼r)
  olusturanId     String
  olusturan       User         @relation("KurumIciDenemeOlusturan", fields: [olusturanId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // BranÅŸ soru paketleri
  soruPaketleri   DenemeSoruPaketi[]
  
  // Ã–ÄŸrenci oturumlarÄ±
  oturumlar       DenemeOturumu[]
  
  aciklama        String?      @db.Text
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([tur])
  @@index([durum])
  @@index([baslangicTarihi])
  @@index([olusturanId])
}

// BranÅŸ bazlÄ± soru paketi (Her Ã¶ÄŸretmen kendi branÅŸÄ± iÃ§in hazÄ±rlar)
model DenemeSoruPaketi {
  id              String       @id @default(uuid())
  
  denemeId        String
  deneme          KurumIciDeneme @relation(fields: [denemeId], references: [id], onDelete: Cascade)
  
  // BranÅŸ bilgisi
  bransKodu       DenemeBrans  // TYT_TURKCE, LGS_MATEMATIK, vs.
  bransAdi        String       // "TÃ¼rkÃ§e", "Matematik", vs.
  soruSayisi      Int          // Bu branÅŸ iÃ§in beklenen soru sayÄ±sÄ±
  
  // HazÄ±rlayan Ã¶ÄŸretmen
  ogretmenId      String
  ogretmen        User         @relation("OgretmenSoruPaketleri", fields: [ogretmenId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  // Sorular (JSON array)
  // Her soru: { 
  //   id: uuid,
  //   soruMetni: string, 
  //   resimUrl?: string (max 8MB, Firebase Storage),
  //   secenekA: string,
  //   secenekB: string,
  //   secenekC: string,
  //   secenekD: string,
  //   secenekE?: string (LGS iÃ§in null),
  //   dogruCevap: 'A'|'B'|'C'|'D'|'E', 
  //   puan: number
  // }
  sorular         String?      @db.LongText
  
  // Onay durumu
  hazirMi         Boolean      @default(false)  // Ã–ÄŸretmen tamamladÄ± mÄ±
  onaylandiMi     Boolean      @default(false)  // MÃ¼dÃ¼r onayladÄ± mÄ±
  onaylayanId     String?
  onayTarihi      DateTime?
  
  // Geri bildirim (mÃ¼dÃ¼rden Ã¶ÄŸretmene)
  geriBildirim    String?      @db.Text
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([denemeId, bransKodu])
  @@index([denemeId])
  @@index([ogretmenId])
  @@index([hazirMi])
  @@index([onaylandiMi])
}

// Ã–ÄŸrenci deneme oturumu
model DenemeOturumu {
  id              String       @id @default(uuid())
  
  denemeId        String
  deneme          KurumIciDeneme @relation(fields: [denemeId], references: [id], onDelete: Cascade)
  
  ogrenciId       String
  ogrenci         User         @relation("OgrenciDenemeOturumlari", fields: [ogrenciId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  baslangicZamani DateTime     @default(now())
  bitisZamani     DateTime?
  
  // Cevaplar (JSON)
  // { "TYT_TURKCE": ["A", "B", "C", ...], "TYT_MATEMATIK": [...] }
  cevaplar        String?      @db.LongText
  
  // SonuÃ§lar (hesaplanan)
  // { "TYT_TURKCE": { dogru: 30, yanlis: 8, bos: 2, net: 28 }, ... }
  sonuclar        String?      @db.LongText
  toplamNet       Float?
  
  tamamlandi      Boolean      @default(false)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@unique([denemeId, ogrenciId])
  @@index([denemeId])
  @@index([ogrenciId])
  @@index([tamamlandi])
}